[REQUEST]
```diff
diff -ruN sources/manifest.json sources/manifest.json
--- sources/manifest.json
+++ sources/manifest.json
@@ -15,7 +15,9 @@
   "permissions": [
     "storage",
     "notifications",
-    "tabs"
+    "tabs",
+    "alarms",
+    "idle"
   ],
   "host_permissions": [
     "<all_urls>"
diff -ruN sources/src/background.js sources/src/background.js
--- sources/src/background.js
+++ sources/src/background.js
@@ -10,8 +10,45 @@
 //   - WHITE : ì•„ë¬´ ì§ˆë¬¸ ì—†ìŒ / ì½ìŒ / (ğŸŸ¢ì—ì„œ í´ë¦­Â·ìŠ¤í¬ë¡¤ë¡œ í™•ì¸ í›„)
 //   - ORANGE: ìƒì„±ì¤‘
 //   - GREEN : ìƒì„±ì™„ë£Œ(í´ë¦­Â·ìŠ¤í¬ë¡¤ë¡œ í™•ì¸ ì „)
-let tabStates = {}; // { tabId: { status: 'WHITE' | 'ORANGE' | 'GREEN', platform: '' } }
-let settings = { dndMode: false, badgeEnabled: true };
+// tabStates êµ¬ì¡°(í™•ì¥ë¨):
+// {
+//   [tabId]: {
+//     status: 'WHITE' | 'ORANGE' | 'GREEN',
+//     platform: string,
+//     siteName?: string,
+//     windowId?: number,
+//     lastUpdateAt?: number,
+//     orangeSinceAt?: number,
+//     lastNudgeAt?: number,
+//   }
+// }
+let tabStates = {};
+
+// ===== Settings (storage.local) =====
+const STORAGE_KEYS = {
+  DND_MODE: 'dndMode',
+  BADGE_ENABLED: 'badgeEnabled',
+  // GeminiëŠ” "ë°±ê·¸ë¼ìš´ë“œì—ì„œëŠ” ì™„ë£Œ UIê°€ ëŠ¦ê²Œ ê°±ì‹ " ë˜ëŠ” ì¼€ì´ìŠ¤ê°€ ìˆì–´ì„œ,
+  // ìœ íœ´(Idle) ìƒíƒœì—ì„œë§Œ "íƒ­ì„ ì ê¹ í™œì„±í™”"í•´ì„œ ì™„ë£Œë¥¼ í™•ì¸í•˜ëŠ” ì˜µì…˜ì„ ì¶”ê°€í•œë‹¤.
+  GEMINI_PROBE_ENABLED: 'geminiProbeEnabled',
+  GEMINI_PROBE_PERIOD_MIN: 'geminiProbePeriodMin',
+  GEMINI_PROBE_ONLY_IDLE: 'geminiProbeOnlyIdle',
+  GEMINI_PROBE_IDLE_SEC: 'geminiProbeIdleSec',
+  GEMINI_PROBE_MIN_ORANGE_SEC: 'geminiProbeMinOrangeSec',
+};
+const GEMINI_PROBE_ALARM = 'ready_ai_gemini_probe';
+const GEMINI_PROBE_MIN_PERIOD_MIN = 1; // chrome.alarms ìµœì†Œ 1ë¶„
+const GEMINI_PROBE_NUDGE_COOLDOWN_MS = 30_000; // ë„ˆë¬´ ìì£¼ íƒ­ ì „í™˜í•˜ë©´ ê±°ìŠ¬ë¦¼
+
+let settings = {
+  dndMode: false,
+  badgeEnabled: true,
+  geminiProbeEnabled: true,
+  geminiProbePeriodMin: 1,
+  geminiProbeOnlyIdle: true,
+  geminiProbeIdleSec: 60,
+  geminiProbeMinOrangeSec: 12,
+};
 let _siteConfigCache = { enabledSites: null, customSites: [] };
 function getSiteConfig(cb) {
   const sitesApi = globalThis?.ReadyAi?.sites;
@@ -35,6 +72,59 @@
     Promise.resolve(callResult).catch(() => {});
   } catch (_) {}
 }
+function sleep(ms) {
+  return new Promise((resolve) => setTimeout(resolve, ms));
+}
+function clampInt(v, fallback, min, max) {
+  const n = parseInt(v, 10);
+  const out = Number.isFinite(n) ? n : fallback;
+  if (typeof min === 'number' && out < min) return min;
+  if (typeof max === 'number' && out > max) return max;
+  return out;
+}
+function clampNumber(v, fallback, min, max) {
+  const n = typeof v === 'number' ? v : parseFloat(v);
+  const out = Number.isFinite(n) ? n : fallback;
+  if (typeof min === 'number' && out < min) return min;
+  if (typeof max === 'number' && out > max) return max;
+  return out;
+}
+function pTabsQuery(query) {
+  return new Promise((resolve) => {
+    try {
+      chrome.tabs.query(query, (tabs) => resolve(Array.isArray(tabs) ? tabs : []));
+    } catch (_) {
+      resolve([]);
+    }
+  });
+}
+function pTabsUpdate(tabId, updateProps) {
+  return new Promise((resolve) => {
+    try {
+      chrome.tabs.update(tabId, updateProps, (tab) => resolve(tab || null));
+    } catch (_) {
+      resolve(null);
+    }
+  });
+}
+function pTabsSendMessage(tabId, message) {
+  return new Promise((resolve) => {
+    try {
+      chrome.tabs.sendMessage(tabId, message, () => resolve(true));
+    } catch (_) {
+      resolve(false);
+    }
+  });
+}
+function pIdleQueryState(idleSec) {
+  return new Promise((resolve) => {
+    try {
+      chrome.idle.queryState(idleSec, (state) => resolve(state || 'active'));
+    } catch (_) {
+      resolve('active');
+    }
+  });
+}
 function clearBadgesForAllTabs() {
   // ë°°ì§€ OFF ì‹œ, "ì´ì „ì— ì´ë¯¸ ì°í˜€ ìˆë˜" ë°°ì§€ë„ ë‚¨ì§€ ì•Šë„ë¡ ì „ì²´ íƒ­ ê¸°ì¤€ìœ¼ë¡œ ì§€ì›€
   chrome.tabs.query({}, (tabs) => {
@@ -50,15 +140,79 @@
     updateIcon(tabId);
   }
 }
+
+function ensureGeminiProbeAlarm() {
+  // ì„¤ì •ê°’ì´ ë°”ë€Œì—ˆì„ ë•Œ, alarmsë¥¼ ì¦‰ì‹œ ë°˜ì˜
+  const enabled = !!settings.geminiProbeEnabled;
+  if (!enabled) {
+    try { chrome.alarms.clear(GEMINI_PROBE_ALARM); } catch (_) {}
+    return;
+  }
+  const periodMin = clampNumber(settings.geminiProbePeriodMin, 1, GEMINI_PROBE_MIN_PERIOD_MIN, 60);
+  try {
+    chrome.alarms.create(GEMINI_PROBE_ALARM, { periodInMinutes: periodMin });
+  } catch (_) {}
+}
+
 // ì´ˆê¸° ì„¤ì • ë¡œë“œ
-chrome.storage.local.get(['dndMode', 'badgeEnabled'], (res) => {
-  settings.dndMode = !!res.dndMode;
-  if (typeof res.badgeEnabled === 'boolean') settings.badgeEnabled = res.badgeEnabled;
-  if (settings.badgeEnabled === false) clearBadgesForAllTabs();
-});
+chrome.storage.local.get([
+  STORAGE_KEYS.DND_MODE,
+  STORAGE_KEYS.BADGE_ENABLED,
+  STORAGE_KEYS.GEMINI_PROBE_ENABLED,
+  STORAGE_KEYS.GEMINI_PROBE_PERIOD_MIN,
+  STORAGE_KEYS.GEMINI_PROBE_ONLY_IDLE,
+  STORAGE_KEYS.GEMINI_PROBE_IDLE_SEC,
+  STORAGE_KEYS.GEMINI_PROBE_MIN_ORANGE_SEC,
+], (res) => {
+  if (typeof res[STORAGE_KEYS.DND_MODE] === 'boolean') settings.dndMode = res[STORAGE_KEYS.DND_MODE];
+  if (typeof res[STORAGE_KEYS.BADGE_ENABLED] === 'boolean') settings.badgeEnabled = res[STORAGE_KEYS.BADGE_ENABLED];
+  if (typeof res[STORAGE_KEYS.GEMINI_PROBE_ENABLED] === 'boolean') settings.geminiProbeEnabled = res[STORAGE_KEYS.GEMINI_PROBE_ENABLED];
+  if (typeof res[STORAGE_KEYS.GEMINI_PROBE_ONLY_IDLE] === 'boolean') settings.geminiProbeOnlyIdle = res[STORAGE_KEYS.GEMINI_PROBE_ONLY_IDLE];
+  if (res[STORAGE_KEYS.GEMINI_PROBE_PERIOD_MIN] != null) settings.geminiProbePeriodMin = clampNumber(res[STORAGE_KEYS.GEMINI_PROBE_PERIOD_MIN], 1, 1, 60);
+  if (res[STORAGE_KEYS.GEMINI_PROBE_IDLE_SEC] != null) settings.geminiProbeIdleSec = clampInt(res[STORAGE_KEYS.GEMINI_PROBE_IDLE_SEC], 60, 15, 3600);
+  if (res[STORAGE_KEYS.GEMINI_PROBE_MIN_ORANGE_SEC] != null) settings.geminiProbeMinOrangeSec = clampInt(res[STORAGE_KEYS.GEMINI_PROBE_MIN_ORANGE_SEC], 12, 3, 600);
+
+  if (settings.badgeEnabled === false) clearBadgesForAllTabs();
+  ensureGeminiProbeAlarm();
+});
 // ì„¤ì • ë³€ê²½ ê°ì§€ (Popupì—ì„œ ë³€ê²½ ì‹œ)
 chrome.storage.onChanged.addListener((changes) => {
-  if (changes.dndMode) settings.dndMode = changes.dndMode.newValue;
-  if (changes.enabledSites || changes.customSites) {
+  if (changes[STORAGE_KEYS.DND_MODE]) settings.dndMode = changes[STORAGE_KEYS.DND_MODE].newValue;
+  if (changes.enabledSites || changes.customSites) {
     // ëª¨ë‹ˆí„°ë§ ëŒ€ìƒì—ì„œ ë¹ ì§„ íƒ­ì€ ìƒíƒœë¥¼ ì§€ì›Œì„œ "ë“±ë¡ëœ ì‚¬ì´íŠ¸ë§Œ" ê´€ë¦¬ë˜ë„ë¡.
     getSiteConfig(() => purgeDisabledTabs());
   }
-  if (changes.badgeEnabled) {
-    settings.badgeEnabled = changes.badgeEnabled.newValue;
+  if (changes[STORAGE_KEYS.BADGE_ENABLED]) {
+    settings.badgeEnabled = changes[STORAGE_KEYS.BADGE_ENABLED].newValue;
     if (settings.badgeEnabled === false) {
       clearBadgesForAllTabs();
     } else {
       refreshTrackedTabs();
     }
   }
+
+  // Gemini probe settings
+  if (changes[STORAGE_KEYS.GEMINI_PROBE_ENABLED]) settings.geminiProbeEnabled = !!changes[STORAGE_KEYS.GEMINI_PROBE_ENABLED].newValue;
+  if (changes[STORAGE_KEYS.GEMINI_PROBE_ONLY_IDLE]) settings.geminiProbeOnlyIdle = !!changes[STORAGE_KEYS.GEMINI_PROBE_ONLY_IDLE].newValue;
+  if (changes[STORAGE_KEYS.GEMINI_PROBE_PERIOD_MIN]) settings.geminiProbePeriodMin = clampNumber(changes[STORAGE_KEYS.GEMINI_PROBE_PERIOD_MIN].newValue, 1, 1, 60);
+  if (changes[STORAGE_KEYS.GEMINI_PROBE_IDLE_SEC]) settings.geminiProbeIdleSec = clampInt(changes[STORAGE_KEYS.GEMINI_PROBE_IDLE_SEC].newValue, 60, 15, 3600);
+  if (changes[STORAGE_KEYS.GEMINI_PROBE_MIN_ORANGE_SEC]) settings.geminiProbeMinOrangeSec = clampInt(changes[STORAGE_KEYS.GEMINI_PROBE_MIN_ORANGE_SEC].newValue, 12, 3, 600);
+
+  // ê´€ë ¨ ì„¤ì •ì´ ë°”ë€Œì—ˆìœ¼ë©´ ì•ŒëŒ ê°±ì‹ 
+  if (
+    changes[STORAGE_KEYS.GEMINI_PROBE_ENABLED] ||
+    changes[STORAGE_KEYS.GEMINI_PROBE_PERIOD_MIN]
+  ) {
+    ensureGeminiProbeAlarm();
+  }
 });
 
+function resolveSiteForUrl(url) {
+  const sitesApi = globalThis?.ReadyAi?.sites;
+  if (!sitesApi?.resolveSiteFromConfig) return null;
+  try {
+    return sitesApi.resolveSiteFromConfig(url, _siteConfigCache.enabledSites, _siteConfigCache.customSites);
+  } catch (_) {
+    return null;
+  }
+}
+function isGeminiSite(site) {
+  if (!site) return false;
+  // builtin: key === 'gemini'
+  if (site.key === 'gemini') return true;
+  // custom: detection === 'gemini'
+  if (site.detection === 'gemini') return true;
+  return false;
+}
+
+async function tickGeminiProbe() {
+  // 1) ì„¤ì • OFFë©´ ì•„ë¬´ ê²ƒë„ ì•ˆ í•¨
+  if (!settings.geminiProbeEnabled) return;
+
+  // 2) í˜„ì¬ íƒ­ë“¤ ì¤‘ "Geminië¡œ ê°ì§€ë˜ëŠ”" íƒ­ë§Œ ê³¨ë¼ì„œ,
+  //    content scriptì— "force_check"ë¥¼ ë³´ë‚´ì„œ ìš°ì„  ê°±ì‹ ì„ ì‹œë„.
+  const tabs = await pTabsQuery({});
+  const now = Date.now();
+
+  /** @type {{tab:any, site:any, orangeAgeSec:number}[]} */
+  const candidates = [];
+
+  for (const t of tabs) {
+    if (!t || typeof t.id !== 'number') continue;
+    const url = t.url || '';
+    if (!url) continue;
+    if (!isMonitoredUrl(url)) continue;
+
+    const site = resolveSiteForUrl(url);
+    if (!isGeminiSite(site)) continue;
+
+    // ë°±ê·¸ë¼ìš´ë“œì—ì„œ ì‹¤í–‰ë˜ëŠ” content scriptì— "ìƒíƒœ í•œë²ˆ ë” ì²´í¬" ìš”ì²­
+    await pTabsSendMessage(t.id, { action: 'force_check', reason: 'gemini_probe_tick' });
+
+    // íƒ­ì„ "ì ê¹ í™œì„±í™”"ì‹œí‚¤ëŠ” nudge í›„ë³´(= ORANGEê°€ ì˜¤ë˜ ìœ ì§€ë˜ëŠ” Gemini íƒ­)
+    const st = tabStates[t.id];
+    if (!st || st.status !== 'ORANGE') continue;
+
+    const orangeSinceAt = st.orangeSinceAt || st.lastUpdateAt || now;
+    const orangeAgeSec = (now - orangeSinceAt) / 1000;
+    const lastNudgeAt = st.lastNudgeAt || 0;
+    const cooledDown = (now - lastNudgeAt) >= GEMINI_PROBE_NUDGE_COOLDOWN_MS;
+    const oldEnough = orangeAgeSec >= (settings.geminiProbeMinOrangeSec || 12);
+    const notAlreadyActive = !t.active;
+
+    if (cooledDown && oldEnough && notAlreadyActive) {
+      candidates.push({ tab: t, site, orangeAgeSec });
+    }
+  }
+
+  // 3) "ìœ íœ´ì¼ ë•Œë§Œ" ì˜µì…˜ì´ë©´, active ìƒíƒœì—ì„œëŠ” ì ˆëŒ€ íƒ­ ì „í™˜ ì•ˆ í•¨
+  let allowNudge = true;
+  if (settings.geminiProbeOnlyIdle) {
+    const idleSec = clampInt(settings.geminiProbeIdleSec, 60, 15, 3600);
+    const state = await pIdleQueryState(idleSec);
+    allowNudge = (state === 'idle' || state === 'locked');
+  }
+  if (!allowNudge) return;
+
+  // 4) í›„ë³´ ì¤‘ "ê°€ì¥ ì˜¤ë˜ ORANGE"ì¸ íƒ­ 1ê°œë§Œ nudge
+  if (!candidates.length) return;
+  candidates.sort((a, b) => b.orangeAgeSec - a.orangeAgeSec);
+  const pick = candidates[0];
+  if (!pick?.tab?.id) return;
+  await nudgeTabForGeminiCompletion(pick.tab.id, pick.tab.windowId);
+}
+
+async function nudgeTabForGeminiCompletion(targetTabId, windowId) {
+  // ì•ˆì „ì¥ì¹˜: í˜„ì¬ tabStatesê°€ ORANGEê°€ ì•„ë‹ˆë©´ êµ³ì´ ì•ˆ ê±´ë“œë¦°ë‹¤.
+  const st = tabStates[targetTabId];
+  if (!st || st.status !== 'ORANGE') {
+    await pTabsSendMessage(targetTabId, { action: 'force_check', reason: 'gemini_probe_nudge_skipped' });
+    return;
+  }
+
+  // ê°™ì€ ìœˆë„ìš°ì—ì„œ ì›ë˜ í™œì„± íƒ­ì„ ì €ì¥í–ˆë‹¤ê°€ ë³µêµ¬
+  const activeTabs = await pTabsQuery({ windowId, active: true });
+  const restoreTabId = (activeTabs && activeTabs[0] && typeof activeTabs[0].id === 'number') ? activeTabs[0].id : null;
+
+  // 1) Gemini íƒ­ì„ í™œì„±í™”
+  await pTabsUpdate(targetTabId, { active: true });
+  await sleep(320);
+
+  // 2) í™œì„±í™”ëœ ê¹€ì— ê°•ì œ ì²´í¬ í•œ ë²ˆ ë”
+  await pTabsSendMessage(targetTabId, { action: 'force_check', reason: 'gemini_probe_nudge' });
+  await sleep(320);
+
+  // 3) ì›ë˜ íƒ­ìœ¼ë¡œ ë³µêµ¬
+  if (restoreTabId != null && restoreTabId !== targetTabId) {
+    await pTabsUpdate(restoreTabId, { active: true });
+  }
+
+  // 4) nudge ì‹œê°„ ê¸°ë¡(ì¿¨ë‹¤ìš´)
+  if (tabStates[targetTabId]) {
+    tabStates[targetTabId].lastNudgeAt = Date.now();
+  }
+}
+
+try {
+  chrome.alarms.onAlarm.addListener((alarm) => {
+    if (!alarm || alarm.name !== GEMINI_PROBE_ALARM) return;
+    safeActionCall(tickGeminiProbe());
+  });
+} catch (_) {}
+
 function updateIcon(tabId) {
   const state = tabStates[tabId]?.status || 'WHITE';
   // ì•„ì´ì½˜ì€ ê¸°ì¡´ ë¦¬ì†ŒìŠ¤ë¥¼ ì¬ì‚¬ìš©(ë±ƒì§€ ìƒ‰ìœ¼ë¡œ êµ¬ë¶„ì´ í•µì‹¬)
   let iconPath = 'assets/bell_profile.png';
@@ -123,28 +277,51 @@
 chrome.runtime.onMessage.addListener((message, sender, sendResponse) => {
   if (!sender.tab) return;
   const tabId = sender.tab.id;
   if (message.action === 'status_update') {
     const prev = tabStates[tabId]?.status;
     const platform = message.platform;
+    const siteName = message.siteName;
     // 1) ìƒì„±ì¤‘ì´ë©´ ë¬´ì¡°ê±´ ORANGE
     if (message.isGenerating) {
-      tabStates[tabId] = { status: 'ORANGE', platform: platform };
+      const now = Date.now();
+      const prevState = tabStates[tabId];
+      // ORANGE ì‹œì‘ ì‹œì  ê¸°ë¡(ê³„ì† ORANGEë©´ ê¸°ì¡´ ê°’ ìœ ì§€)
+      const orangeSinceAt = (prevState?.status === 'ORANGE' && prevState?.orangeSinceAt)
+        ? prevState.orangeSinceAt
+        : now;
+      tabStates[tabId] = {
+        ...(prevState || {}),
+        status: 'ORANGE',
+        platform,
+        siteName,
+        windowId: sender.tab.windowId,
+        lastUpdateAt: now,
+        orangeSinceAt,
+      };
       updateIcon(tabId);
       return;
     }
     // 2) ìƒì„±ì´ ì•„ë‹ˆë¼ë©´:
     //    - ORANGE -> GREEN (ì™„ë£Œ)
     //    - (ì²« ë³´ê³ ) -> WHITE (ì•„ë¬´ ì§ˆë¬¸ ì—†ìŒ)
     //    - GREEN/WHITE ìœ ì§€
     if (!prev) {
-      tabStates[tabId] = { status: 'WHITE', platform: platform };
+      tabStates[tabId] = {
+        status: 'WHITE',
+        platform,
+        siteName,
+        windowId: sender.tab.windowId,
+        lastUpdateAt: Date.now(),
+      };
       updateIcon(tabId);
       return;
     }
     if (prev === 'ORANGE') {
-      tabStates[tabId] = { status: 'GREEN', platform: platform };
+      tabStates[tabId] = {
+        ...(tabStates[tabId] || {}),
+        status: 'GREEN',
+        platform,
+        siteName,
+        windowId: sender.tab.windowId,
+        lastUpdateAt: Date.now(),
+        orangeSinceAt: null,
+      };
       updateIcon(tabId);
       // íƒ­ì´ í˜„ì¬ ë¹„í™œì„±ì´ë©´(ë‹¤ë¥¸ íƒ­ ë³´ê³  ìˆìœ¼ë©´) ì•Œë¦¼ì„ ë³´ë‚¼ ìˆ˜ ìˆìŒ
       chrome.tabs.query({ active: true, currentWindow: true }, (tabs) => {
         const isActiveTab = tabs.length > 0 && tabs[0].id === tabId;
-        if (!isActiveTab && !settings.dndMode) sendNotification(platform);
+        if (!isActiveTab && !settings.dndMode) sendNotification(platform, siteName);
       });
       return;
     }
     // prevê°€ GREEN/WHITEì¸ë° isGenerating=falseê°€ ì™”ë‹¤ë©´ ìƒíƒœëŠ” ê·¸ëŒ€ë¡œ ë‘”ë‹¤.
     // (ğŸŸ¢ëŠ” í´ë¦­/ìŠ¤í¬ë¡¤ ë©”ì‹œì§€ë¡œë§Œ âšªë¡œ ë°”ë€ë‹¤)
     if (prev === 'GREEN' || prev === 'WHITE') {
       // platformë§Œ ìµœì‹ ìœ¼ë¡œ ë³´ì •
       tabStates[tabId].platform = platform;
+      tabStates[tabId].siteName = siteName;
+      tabStates[tabId].windowId = sender.tab.windowId;
+      tabStates[tabId].lastUpdateAt = Date.now();
       updateIcon(tabId);
       return;
     }
   }
   // content ìª½ ì‚¬ìš©ì ìƒí˜¸ì‘ìš©(í´ë¦­/ìŠ¤í¬ë¡¤)ë¡œ ğŸŸ¢ -> âšª
@@ -157,16 +334,23 @@
       updateIcon(tabId);
     }
   }
 });
-function sendNotification(platform) {
-  let title = "AI ë‹µë³€ ì™„ë£Œ";
-  if (platform === 'chatgpt') title = "ChatGPT ë‹µë³€ ì™„ë£Œ";
-  else if (platform === 'gemini') title = "Gemini ë‹µë³€ ì™„ë£Œ";
+function sendNotification(platform, siteName) {
+  let title = siteName ? `${siteName} ë‹µë³€ ì™„ë£Œ` : "AI ë‹µë³€ ì™„ë£Œ";
+  // í˜¸í™˜/ë°±ì—…: siteNameì´ ì—†ì„ ë•Œë§Œ í”Œë«í¼ë³„ë¡œ ì¹˜í™˜
+  if (!siteName) {
+    if (platform === 'chatgpt') title = "ChatGPT ë‹µë³€ ì™„ë£Œ";
+    else if (platform === 'gemini') title = "Gemini ë‹µë³€ ì™„ë£Œ";
+    else if (platform === 'aistudio') title = "AI Studio ë‹µë³€ ì™„ë£Œ";
+    else if (platform === 'claude') title = "Claude ë‹µë³€ ì™„ë£Œ";
+  }
   chrome.notifications.create({
     type: 'basic',
     iconUrl: 'assets/bell_notice.png',
     title: title,
     message: "ì‘ì—…ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤. í™•ì¸í•˜ë ¤ë©´ í´ë¦­í•˜ì„¸ìš”.",
     priority: 2
   });
 }
diff -ruN sources/src/content.js sources/src/content.js
--- sources/src/content.js
+++ sources/src/content.js
@@ -97,6 +97,7 @@
 const _deepRoots = new Set(); // Document | ShadowRoot
 const _deepObservers = new Map(); // root -> MutationObserver
 let _lastShadowRescanAt = 0;
 const SHADOW_RESCAN_MS = 4000;
+let _deepEnabled = false;
 function addDeepRoot(root) {
   if (!root) return;
   if (_deepRoots.has(root)) return;
@@ -174,6 +175,31 @@
     scanTreeForShadowRoots(document.documentElement);
   } catch (_) {}
 }
+function shutdownDeepRoots() {
+  // stopMonitoring()ì—ì„œ í˜¸ì¶œí•´ì„œ, ì‚¬ì´íŠ¸ ì´ë™/ë¹„í™œì„± ì‹œ ë¦¬ì†ŒìŠ¤ ì •ë¦¬
+  try {
+    for (const obs of _deepObservers.values()) {
+      try { obs.disconnect(); } catch (_) {}
+    }
+  } catch (_) {}
+  _deepObservers.clear();
+  _deepRoots.clear();
+  _lastShadowRescanAt = 0;
+}
+function setDeepEnabled(on) {
+  const next = !!on;
+  if (next === _deepEnabled) return;
+  _deepEnabled = next;
+  if (_deepEnabled) {
+    try { initDeepRoots(); } catch (_) {}
+  } else {
+    try { shutdownDeepRoots(); } catch (_) {}
+  }
+}
 function deepQuerySelectorAll(selector) {
   const out = [];
   for (const root of _deepRoots) {
@@ -235,7 +261,8 @@
 function detectGeminiGenerating() {
   // Gemini: "ì¤‘ì§€" ë˜ëŠ” "Stop" ë‹¨ì–´ê°€ ë“¤ì–´ê°„ ë²„íŠ¼ì´ í™”ë©´ì— ë³´ì´ëŠ”ì§€ í™•ì¸
   const selector = '[aria-label*="ì¤‘ì§€"], [aria-label*="Stop"], [aria-label*="stop"]';
-  const btns = Array.from(document.querySelectorAll(selector));
+  const btns = _deepEnabled ? deepQuerySelectorAll(selector) : Array.from(document.querySelectorAll(selector));
   return btns.some((btn) => isVisible(btn));
 }
 function detectAiStudioGenerating() {
@@ -267,6 +294,11 @@
 function checkStatus() {
   if (!monitoring || !activeSite) return;
   const platform = activeSite.key;
   let currentlyGenerating = false;
   try {
+    // Gemini/Shadow DOM ì¼€ì´ìŠ¤ì—ì„œ "Stop ë²„íŠ¼ ìˆ¨ê¹€" ë³€í™”ë¥¼ ë†“ì¹˜ì§€ ì•Šë„ë¡
+    // ì£¼ê¸°ì ìœ¼ë¡œ open shadowRootë¥¼ ë‹¤ì‹œ ìŠ¤ìº”í•œë‹¤.
+    if (_deepEnabled) maybeRescanShadowRoots();
     currentlyGenerating = detectGenerating(activeSite);
   } catch (_) {
     currentlyGenerating = false;
   }
@@ -292,6 +324,7 @@
     chrome.runtime.sendMessage({
       action: "status_update",
       platform,
+      siteName: activeSite.name,
       isGenerating,
     });
     hasSentInitialState = true;
@@ -300,6 +333,7 @@
     chrome.runtime.sendMessage({
       action: "status_update",
       platform,
+      siteName: activeSite.name,
       isGenerating,
     });
     hasSentInitialState = true;
@@ -312,6 +346,7 @@
 function markAsAcknowledged() {
   if (!monitoring) return;
   if (isGenerating) return;
   if (completionStatus !== 'completed') return;
@@ -322,9 +357,9 @@
   // background(íˆ´ë°” ë°°ì§€)ë„ ê°™ì´ âšªë¡œ ë°”ê¿”ì¤€ë‹¤.
   chrome.runtime.sendMessage({
     action: 'user_activity',
-    platform: getSiteKey()
+    platform: getSiteKey(),
+    siteName: activeSite?.name,
   });
 }
 // =========================
@@ -350,6 +385,11 @@
   monitoring = true;
   isGenerating = false;
   completionStatus = 'idle';
   hasSentInitialState = false;
+  // "ë°±ê·¸ë¼ìš´ë“œ íƒ­"ì—ì„œë„ Gemini ì™„ë£Œ ê°ì§€ê°€ ê°€ëŠ¥í•˜ë„ë¡
+  // open shadowRootê¹Œì§€ í¬í•¨í•´ì„œ DOM ë³€í™”ë¥¼ ì¶”ì í•œë‹¤.
+  // (ChatGPT/AiStudioë„ shadowRootë¥¼ ì“°ëŠ” ê²½ìš°ê°€ ìˆì–´ì„œ ê°™ì´ ì¼ ë‹¤)
+  setDeepEnabled(true);
   bindHandlersOnce();
   // DOM ë³€í™”ë¥¼ ê°ì§€í•˜ì—¬ ì²´í¬ ì‹¤í–‰
   _observer = new MutationObserver(() => {
@@ -367,6 +407,13 @@
       childList: true,
       subtree: true,
+      // GeminiëŠ” childList ë³€í™” ì—†ì´ style/class/aria-labelë§Œ ë°”ë€ŒëŠ” ê²½ìš°ê°€ ìˆì–´
+      // attributes ê°ì‹œë¥¼ ì¼œì•¼ ğŸŸ  -> ğŸŸ¢ ì „í™˜ì„ ë†“ì¹˜ì§€ ì•ŠëŠ”ë‹¤.
+      attributes: true,
+      attributeFilter: ['aria-label', 'style', 'class', 'hidden', 'disabled']
     });
   } catch (_) {
     // ì¼ë¶€ ë¬¸ì„œ(íŠ¹ìˆ˜ í”„ë ˆì„)ì—ì„œëŠ” observe ì‹¤íŒ¨í•  ìˆ˜ ìˆìŒ
   }
@@ -390,6 +437,7 @@
   if (_observer) {
     try { _observer.disconnect(); } catch (_) {}
     _observer = null;
   }
+  setDeepEnabled(false);
   clearTitleBadge();
 }
@@ -420,3 +468,20 @@
 refreshSiteFromStorage();
 console.log('[Ready_Ai] content script loaded');
+
+// background(service_worker)ì—ì„œ ê°•ì œ ì²´í¬ ìš”ì²­
+try {
+  chrome.runtime.onMessage.addListener((msg, sender, sendResponse) => {
+    if (!msg) return;
+    if (msg.action === 'force_check') {
+      // ìƒíƒœëŠ” polling/observerë¡œë„ ê°±ì‹ ë˜ì§€ë§Œ,
+      // GeminiëŠ” íƒ­ í™œì„±í™” ì§í›„ì— DOMì´ í¬ê²Œ ë³€í•˜ëŠ” ê²½ìš°ê°€ ìˆì–´
+      // backgroundì—ì„œ "ì§€ê¸ˆ í•œ ë²ˆë§Œ" ë” ì²´í¬í•˜ë¼ê³  ì‹ í˜¸ë¥¼ ì¤„ ìˆ˜ ìˆê²Œ í•œë‹¤.
+      scheduleCheck();
+      try { sendResponse?.({ ok: true }); } catch (_) {}
+      return;
+    }
+  });
+} catch (_) {}
diff -ruN sources/src/popup.html sources/src/popup.html
--- sources/src/popup.html
+++ sources/src/popup.html
@@ -56,6 +56,43 @@
     <div class="option">
       <span>ë°©í•´ê¸ˆì§€ (DND)</span>
       <label class="switch">
         <input type="checkbox" id="dnd-toggle">
         <span class="slider"></span>
       </label>
     </div>
     <div class="desc">í™œì„±í™” ì‹œ ì™„ë£Œ ì•Œë¦¼ íŒì—…ì´ ëœ¨ì§€ ì•ŠìŠµë‹ˆë‹¤. (ì•„ì´ì½˜ ë°°ì§€ëŠ” ê³„ì† í‘œì‹œë¨)</div>
+
+    <div class="divider"></div>
+    <div class="section-title">Gemini ìë™ ì™„ë£Œ í™•ì¸</div>
+    <div class="option">
+      <span>ìœ íœ´(Idle)ì¼ ë•Œë§Œ í™•ì¸ ğŸŸ¢</span>
+      <label class="switch">
+        <input type="checkbox" id="gemini-probe-toggle">
+        <span class="slider"></span>
+      </label>
+    </div>
+    <div class="desc">
+      GeminiëŠ” ë°±ê·¸ë¼ìš´ë“œ íƒ­ì—ì„œ ë‹µë³€ì´ ì´ë¯¸ ëë‚¬ì–´ë„ UI(Stop ë²„íŠ¼)ê°€ ëŠ¦ê²Œ ê°±ì‹ ë˜ì–´ ğŸŸ ê°€ ì˜¤ë˜ ìœ ì§€ë˜ëŠ” ê²½ìš°ê°€ ìˆìŠµë‹ˆë‹¤.
+      ì´ ì˜µì…˜ì„ ì¼œë©´, PCê°€ ìœ íœ´ ìƒíƒœì¼ ë•Œë§Œ íƒ­ì„ ì•„ì£¼ ì ê¹ í™œì„±í™”í•´ì„œ ì™„ë£Œ ì—¬ë¶€ë¥¼ í™•ì¸í•©ë‹ˆë‹¤.
+      (ì‚¬ìš© ì¤‘ì¼ ë•ŒëŠ” ì ˆëŒ€ íƒ­ ì „í™˜ì„ í•˜ì§€ ì•ŠìŒ)
+    </div>
+
+    <div class="custom-form" style="margin-top:10px;">
+      <div class="field">
+        <label>í™•ì¸ ì£¼ê¸°(ë¶„, ìµœì†Œ 1)</label>
+        <input type="text" id="gemini-probe-period" placeholder="1" />
+      </div>
+      <div class="field">
+        <label>ìœ íœ´ íŒì • ê¸°ì¤€(ì´ˆ)</label>
+        <input type="text" id="gemini-probe-idle-sec" placeholder="60" />
+      </div>
+      <div class="field">
+        <label>ğŸŸ  ìœ ì§€ í›„ ê°•ì œ í™•ì¸ ì‹œì‘(ì´ˆ)</label>
+        <input type="text" id="gemini-probe-min-orange-sec" placeholder="12" />
+      </div>
+      <div class="hint">
+        â€» í™”ë©´ ì „í™˜ì´ ê±°ìŠ¬ë¦¬ë©´ ìœ„ ìŠ¤ìœ„ì¹˜ë¥¼ ë„ë©´ ë©ë‹ˆë‹¤. (íƒ­ ì „í™˜ ì—†ì´ ê°€ëŠ¥í•œ ë²”ìœ„ ë‚´ì—ì„œëŠ” ê³„ì† ê°ì§€ ì‹œë„)
+      </div>
+    </div>
+
     <div class="divider"></div>
     <div class="section-title">ì‚¬ì´íŠ¸ ë“±ë¡(ê¸°ë³¸)</div>
     <div class="site-list" id="builtin-sites"></div>
diff -ruN sources/src/popup.js sources/src/popup.js
--- sources/src/popup.js
+++ sources/src/popup.js
@@ -8,13 +8,52 @@
 function loadConfig(cb) {
   const sitesApi = getSitesApi();
   const enabledKey = sitesApi?.STORAGE_KEYS?.ENABLED_SITES || 'enabledSites';
   const customKey = sitesApi?.STORAGE_KEYS?.CUSTOM_SITES || 'customSites';
-  chrome.storage.local.get(['dndMode', enabledKey, customKey], (res) => {
+  chrome.storage.local.get([
+    'dndMode',
+    enabledKey,
+    customKey,
+    // Gemini auto probe
+    'geminiProbeEnabled',
+    'geminiProbePeriodMin',
+    'geminiProbeIdleSec',
+    'geminiProbeMinOrangeSec',
+  ], (res) => {
     const enabledSites = sitesApi?.ensureEnabledSitesObject
       ? sitesApi.ensureEnabledSitesObject(res?.[enabledKey])
       : (res?.[enabledKey] || {});
     const customSites = sitesApi?.normalizeCustomSites
       ? sitesApi.normalizeCustomSites(res?.[customKey])
       : (res?.[customKey] || []);
     cb({
       dndMode: !!res.dndMode,
       enabledSites,
       customSites,
+      // defaults are mirrored with background.js
+      geminiProbeEnabled: (typeof res.geminiProbeEnabled === 'boolean') ? res.geminiProbeEnabled : true,
+      geminiProbePeriodMin: (res.geminiProbePeriodMin != null) ? res.geminiProbePeriodMin : 1,
+      geminiProbeIdleSec: (res.geminiProbeIdleSec != null) ? res.geminiProbeIdleSec : 60,
+      geminiProbeMinOrangeSec: (res.geminiProbeMinOrangeSec != null) ? res.geminiProbeMinOrangeSec : 12,
     });
   });
 }
 function saveConfig(cfg, cb) {
   const sitesApi = getSitesApi();
   const enabledKey = sitesApi?.STORAGE_KEYS?.ENABLED_SITES || 'enabledSites';
   const customKey = sitesApi?.STORAGE_KEYS?.CUSTOM_SITES || 'customSites';
   chrome.storage.local.set(
     {
       dndMode: !!cfg.dndMode,
       [enabledKey]: cfg.enabledSites,
       [customKey]: cfg.customSites,
+      // Gemini auto probe
+      geminiProbeEnabled: !!cfg.geminiProbeEnabled,
+      geminiProbePeriodMin: cfg.geminiProbePeriodMin,
+      geminiProbeIdleSec: cfg.geminiProbeIdleSec,
+      geminiProbeMinOrangeSec: cfg.geminiProbeMinOrangeSec,
+      // ê³ ì •: 'ìœ íœ´ì¼ ë•Œë§Œ' (íƒ­ ì „í™˜ì´ ê±°ìŠ¬ë¦´ ìˆ˜ ìˆìœ¼ë‹ˆ ê¸°ë³¸ ì„¤ê³„ ìì²´ë¥¼ ì•ˆì „í•˜ê²Œ)
+      geminiProbeOnlyIdle: true,
     },
     () => cb?.()
   );
 }
+
+function clampInt(v, fallback, min, max) {
+  const n = parseInt(v, 10);
+  const out = Number.isFinite(n) ? n : fallback;
+  if (typeof min === 'number' && out < min) return min;
+  if (typeof max === 'number' && out > max) return max;
+  return out;
+}
+function clampNumber(v, fallback, min, max) {
+  const n = typeof v === 'number' ? v : parseFloat(v);
+  const out = Number.isFinite(n) ? n : fallback;
+  if (typeof min === 'number' && out < min) return min;
+  if (typeof max === 'number' && out > max) return max;
+  return out;
+}
@@ -160,6 +196,44 @@
     cfg.dndMode = dndToggle.checked;
     saveConfig(cfg, () => setHint('ì €ì¥ë¨'));
   });
+
+  // ===== Gemini auto probe =====
+  const probeToggle = $('gemini-probe-toggle');
+  const probePeriod = $('gemini-probe-period');
+  const probeIdleSec = $('gemini-probe-idle-sec');
+  const probeMinOrangeSec = $('gemini-probe-min-orange-sec');
+
+  if (probeToggle) {
+    probeToggle.checked = !!cfg.geminiProbeEnabled;
+    probeToggle.addEventListener('change', () => {
+      cfg.geminiProbeEnabled = !!probeToggle.checked;
+      saveConfig(cfg, () => setHint('ì €ì¥ë¨'));
+    });
+  }
+  if (probePeriod) {
+    probePeriod.value = String(cfg.geminiProbePeriodMin ?? 1);
+    probePeriod.addEventListener('change', () => {
+      cfg.geminiProbePeriodMin = clampNumber(probePeriod.value, 1, 1, 60);
+      probePeriod.value = String(cfg.geminiProbePeriodMin);
+      saveConfig(cfg, () => setHint('ì €ì¥ë¨'));
+    });
+  }
+  if (probeIdleSec) {
+    probeIdleSec.value = String(cfg.geminiProbeIdleSec ?? 60);
+    probeIdleSec.addEventListener('change', () => {
+      cfg.geminiProbeIdleSec = clampInt(probeIdleSec.value, 60, 15, 3600);
+      probeIdleSec.value = String(cfg.geminiProbeIdleSec);
+      saveConfig(cfg, () => setHint('ì €ì¥ë¨'));
+    });
+  }
+  if (probeMinOrangeSec) {
+    probeMinOrangeSec.value = String(cfg.geminiProbeMinOrangeSec ?? 12);
+    probeMinOrangeSec.addEventListener('change', () => {
+      cfg.geminiProbeMinOrangeSec = clampInt(probeMinOrangeSec.value, 12, 3, 600);
+      probeMinOrangeSec.value = String(cfg.geminiProbeMinOrangeSec);
+      saveConfig(cfg, () => setHint('ì €ì¥ë¨'));
+    });
+  }
   $('add-custom').addEventListener('click', () => {
     const sitesApi = getSitesApi();
     if (!sitesApi) return;
```

---

### ìš”ì•½

* **Gemini â€œë°±ê·¸ë¼ìš´ë“œë¼ì„œ ğŸŸ ê°€ ì•ˆ í’€ë¦¬ëŠ”â€ ë¬¸ì œ**ë¥¼ ì¡ê¸° ìœ„í•´, **ì£¼ê¸°ì  ì²´í¬ + ìœ íœ´(Idle)ì¼ ë•Œë§Œ íƒ­ì„ ì•„ì£¼ ì ê¹ í™œì„±í™”(nudge)** í•˜ëŠ” ë¡œì§ì„ ì¶”ê°€í–ˆì–´.
* **content.js ìª½ì€ Shadow DOMê¹Œì§€ í¬í•¨í•´ Stop ë²„íŠ¼ ë³€í™”ë¥¼ ë” ì˜ ì¡ë„ë¡**(deep scan + attributes ê°ì‹œ) ë³´ê°•í–ˆê³ , **backgroundì—ì„œ `force_check` ë©”ì‹œì§€ë¡œ ì¦‰ì‹œ ì¬ê²€ì‚¬**ë„ ê°€ëŠ¥í•˜ê²Œ í–ˆì–´.
* **íŒì—…ì— ì˜µì…˜**(ì£¼ê¸°/ìœ íœ´ê¸°ì¤€/ğŸŸ  ìœ ì§€ì‹œê°„) ë„£ì—ˆê³ , **manifestì— alarms/idle ê¶Œí•œ** ì¶”ê°€í–ˆì–´.


==================================================
[CONTEXT / CODE]
### [PROJECT TREE] (Ready_Ai)
==================================================
Ready_Ai/
    .ai_request_draft.json
    manifest.json
    .ai_request_draft_legacy/
    assets/
    docs/
    src/
        background.js
        content.js
        popup.html
        popup.js
        sites.js
### [EXCLUDED TREE] (Ready_Ai)
==================================================
Ready_Ai/
    .git/  [EXCLUDED: ex_dir]
    assets/
        bell_alert.png  [EXCLUDED: not_included_ext]
        bell_notice.png  [EXCLUDED: not_included_ext]
        bell_pending.png  [EXCLUDED: not_included_ext]
        bell_profile.png  [EXCLUDED: not_included_ext]
        bell_system.png  [EXCLUDED: not_included_ext]
        bell_unread.png  [EXCLUDED: not_included_ext]
    docs/
        Code_Changes/  [EXCLUDED: ex_dir]
    src/
        icon.png  [EXCLUDED: not_included_ext]
    .gitignore  [EXCLUDED: not_included_ext]

### [CONTENTS] ###
==================================================

FILE: .ai_request_draft.json
----------------------------------------
```json
{
  "buffers": {
    "_062bc1_extension": {
      "saved_at": 1770028253.5194767,
      "state": {
        "single": {
          "edit": {
            "current_file": null,
            "edit_content": "",
            "cmb_selected": ""
          },
          "new": {
            "current_file": null,
            "title": "",
            "prompt": ""
          },
          "tpl": {
            "current_file": null,
            "title": "",
            "prompt": ""
          }
        },
        "split": {
          "left": {
            "edit": {
              "current_file": null,
              "edit_content": "",
              "cmb_selected": ""
            },
            "new": {
              "current_file": null,
              "title": "",
              "prompt": ""
            },
            "tpl": {
              "current_file": null,
              "title": "",
              "prompt": ""
            }
          },
          "right": {
            "edit": {
              "current_file": null,
              "edit_content": "",
              "cmb_selected": ""
            },
            "new": {
              "current_file": null,
              "title": "",
              "prompt": ""
            },
            "tpl": {
              "current_file": null,
              "title": "",
              "prompt": ""
            }
          }
        }
      },
      "ui": {
        "split_left_idx": 0,
        "split_right_idx": 0
      }
    },
    "_062bc1_py": {
      "saved_at": 1770302893.1931014,
      "state": {
        "single": {
          "edit": {
            "current_file": null,
            "edit_content": "",
            "cmb_selected": ""
          },
          "new": {
            "current_file": null,
            "title": "",
            "prompt": ""
          },
          "tpl": {
            "current_file": null,
            "title": "",
            "prompt": ""
          }
        },
        "split": {
          "left": {
            "edit": {
              "current_file": null,
              "edit_content": "",
              "cmb_selected": ""
            },
            "new": {
              "current_file": null,
              "title": "",
              "prompt": ""
            },
            "tpl": {
              "current_file": null,
              "title": "",
              "prompt": ""
            }
          },
          "right": {
            "edit": {
              "current_file": null,
              "edit_content": "",
              "cmb_selected": ""
            },
            "new": {
              "current_file": null,
              "title": "",
              "prompt": ""
            },
            "tpl": {
              "current_file": null,
              "title": "",
              "prompt": ""
            }
          }
        }
      },
      "ui": {
        "split_left_idx": 0,
        "split_right_idx": 0
      }
    },
    "_default": {
      "saved_at": 1770786045.5255792,
      "state": {
        "single": {
          "edit": {
            "current_file": null,
            "edit_content": "",
            "cmb_selected": "Code_Changes_1_ìš”ì²­ì™„ë£Œ.txt"
          },
          "new": {
            "current_file": null,
            "title": "",
            "prompt": ""
          },
          "tpl": {
            "current_file": null,
            "title": "ë¦¬íŒ©í† ë§ Clean Code",
            "prompt": "ì•„ë˜ ì½”ë“œë¥¼ í´ë¦° ì½”ë“œ ì›ì¹™(ë³€ìˆ˜ëª… ëª…í™•í™”, í•¨ìˆ˜ ë¶„ë¦¬, ì¤‘ë³µ ì œê±°)ì— ë”°ë¼ ë¦¬íŒ©í† ë§í•´ì¤˜.\nê¸°ëŠ¥ì˜ ë³€í™”ëŠ” ì—†ì–´ì•¼ í•˜ë©°, ê°€ë…ì„±ê³¼ ìœ ì§€ë³´ìˆ˜ì„±ì„ ë†’ì´ëŠ” ê²ƒì´ ëª©í‘œì•¼."
          }
        },
        "split": {
          "left": {
            "edit": {
              "current_file": null,
              "edit_content": "",
              "cmb_selected": "Code_Changes_1_ìš”ì²­ì™„ë£Œ.txt"
            },
            "new": {
              "current_file": null,
              "title": "",
              "prompt": ""
            },
            "tpl": {
              "current_file": null,
              "title": "",
              "prompt": ""
            }
          },
          "right": {
            "edit": {
              "current_file": null,
              "edit_content": "",
              "cmb_selected": "Code_Changes_1_ìš”ì²­ì™„ë£Œ.txt"
            },
            "new": {
              "current_file": null,
              "title": "",
              "prompt": ""
            },
            "tpl": {
              "current_file": null,
              "title": "",
              "prompt": ""
            }
          }
        }
      },
      "ui": {
        "split_left_idx": 0,
        "split_right_idx": 0
      }
    },
    "_82f06a_ì£¼ìš”ì•±_ë¦¬íŒ©í† ë§": {
      "saved_at": 1770240394.731935,
      "state": {
        "single": {
          "edit": {
            "current_file": null,
            "edit_content": "",
            "cmb_selected": ""
          },
          "new": {
            "current_file": null,
            "title": "",
            "prompt": ""
          },
          "tpl": {
            "current_file": null,
            "title": "",
            "prompt": ""
          }
        },
        "split": {
          "left": {
            "edit": {
              "current_file": null,
              "edit_content": "",
              "cmb_selected": ""
            },
            "new": {
              "current_file": null,
              "title": "",
              "prompt": ""
            },
            "tpl": {
              "current_file": null,
              "title": "",
              "prompt": ""
            }
          },
          "right": {
            "edit": {
              "current_file": null,
              "edit_content": "",
              "cmb_selected": ""
            },
            "new": {
              "current_file": null,
              "title": "",
              "prompt": ""
            },
            "tpl": {
              "current_file": null,
              "title": "",
              "prompt": ""
            }
          }
        }
      },
      "ui": {
        "split_left_idx": 0,
        "split_right_idx": 0
      }
    }
  },
  "version": 2,
  "active_buffer": "_default",
  "saved_at": 1770786754.5457613,
  "project_key": "c:\\users\\dl971\\development\\project-extension\\ready_ai"
}
```

FILE: manifest.json
----------------------------------------
```json
{
  "manifest_version": 3,
  "name": "Jaeheon Extension",
  "version": "0.1.0",
  "description": "AI(ChatGPT, Gemini) ë‹µë³€ ì™„ë£Œ ì•Œë¦¼ ë° ìƒíƒœ ê´€ë¦¬",
  "background": {
    "service_worker": "src/background.js"
  },
  "action": {
    "default_popup": "src/popup.html",
    "default_icon": {
      "128": "assets/bell_profile.png"
    }
  },
  "permissions": [
    "storage",
    "notifications",
    "tabs"
  ],
  "host_permissions": [
    "<all_urls>"
  ],
  "content_scripts": [
    {
      "matches": [
        "https://*/*",
        "http://*/*"
      ],
      "js": [
        "src/sites.js",
        "src/content.js"
      ]
    }
  ]
}

```

FILE: src\background.js
----------------------------------------
```js
// sites registry (builtin/custom)
try {
  // background(service_worker)ëŠ” extension root ê¸°ì¤€ ê²½ë¡œê°€ ì•ˆì „í•¨
  importScripts('src/sites.js');
} catch (_) {
  // ignore
}

// ìƒíƒœ ê´€ë¦¬ ë³€ìˆ˜
// ìš”êµ¬ì‚¬í•­(3ìƒíƒœ):
//   - WHITE : ì•„ë¬´ ì§ˆë¬¸ ì—†ìŒ / ì½ìŒ / (ğŸŸ¢ì—ì„œ í´ë¦­Â·ìŠ¤í¬ë¡¤ë¡œ í™•ì¸ í›„)
//   - ORANGE: ìƒì„±ì¤‘
//   - GREEN : ìƒì„±ì™„ë£Œ(í´ë¦­Â·ìŠ¤í¬ë¡¤ë¡œ í™•ì¸ ì „)
let tabStates = {}; // { tabId: { status: 'WHITE' | 'ORANGE' | 'GREEN', platform: '' } }
let settings = { dndMode: false, badgeEnabled: true };
let _siteConfigCache = { enabledSites: null, customSites: [] };

function getSiteConfig(cb) {
  const sitesApi = globalThis?.ReadyAi?.sites;
  const enabledKey = sitesApi?.STORAGE_KEYS?.ENABLED_SITES || 'enabledSites';
  const customKey = sitesApi?.STORAGE_KEYS?.CUSTOM_SITES || 'customSites';

  chrome.storage.local.get([enabledKey, customKey], (res) => {
    const enabledSites = sitesApi?.ensureEnabledSitesObject
      ? sitesApi.ensureEnabledSitesObject(res?.[enabledKey])
      : (res?.[enabledKey] || {});
    const customSites = sitesApi?.normalizeCustomSites
      ? sitesApi.normalizeCustomSites(res?.[customKey])
      : (res?.[customKey] || []);
    _siteConfigCache = { enabledSites, customSites };
    cb?.(_siteConfigCache);
  });
}
// ì´ˆê¸° ì„¤ì • ë¡œë“œ

function safeActionCall(callResult) {
  // Chrome MV3 í™˜ê²½ì— ë”°ë¼ promise/void ë‘˜ ë‹¤ ì˜¬ ìˆ˜ ìˆì–´ì„œ ì•ˆì „í•˜ê²Œ ì²˜ë¦¬
  try {
    Promise.resolve(callResult).catch(() => {});
  } catch (_) {}
}

function clearBadgesForAllTabs() {
  // ë°°ì§€ OFF ì‹œ, "ì´ì „ì— ì´ë¯¸ ì°í˜€ ìˆë˜" ë°°ì§€ë„ ë‚¨ì§€ ì•Šë„ë¡ ì „ì²´ íƒ­ ê¸°ì¤€ìœ¼ë¡œ ì§€ì›€
  chrome.tabs.query({}, (tabs) => {
    for (const t of tabs) {
      if (!t || typeof t.id !== 'number') continue;
      safeActionCall(chrome.action.setBadgeText({ text: '', tabId: t.id }));
    }
  });
}

function refreshTrackedTabs() {
  // í˜„ì¬ ìƒíƒœë¥¼ ì•Œê³  ìˆëŠ” íƒ­(= tabStates)ì— ëŒ€í•´ì„œë§Œ ì•„ì´ì½˜/ë°°ì§€ë¥¼ ë‹¤ì‹œ ë°˜ì˜
  for (const id of Object.keys(tabStates)) {
    const tabId = parseInt(id, 10);
    if (!Number.isFinite(tabId)) continue;
    updateIcon(tabId);
  }
}

// ì´ˆê¸° ì„¤ì • ë¡œë“œ
chrome.storage.local.get(['dndMode', 'badgeEnabled'], (res) => {
  if (typeof res.dndMode === 'boolean') settings.dndMode = res.dndMode;
  if (typeof res.badgeEnabled === 'boolean') settings.badgeEnabled = res.badgeEnabled;
  if (settings.badgeEnabled === false) clearBadgesForAllTabs();
});

// ì„¤ì • ë³€ê²½ ê°ì§€ (Popupì—ì„œ ë³€ê²½ ì‹œ)
chrome.storage.onChanged.addListener((changes) => {
  if (changes.dndMode) settings.dndMode = changes.dndMode.newValue;
  if (changes.enabledSites || changes.customSites) {
    // ëª¨ë‹ˆí„°ë§ ëŒ€ìƒì—ì„œ ë¹ ì§„ íƒ­ì€ ìƒíƒœë¥¼ ì§€ì›Œì„œ "ë“±ë¡ëœ ì‚¬ì´íŠ¸ë§Œ" ê´€ë¦¬ë˜ë„ë¡.
    getSiteConfig(() => purgeDisabledTabs());
  }

  if (changes.badgeEnabled) {
    settings.badgeEnabled = changes.badgeEnabled.newValue;
    if (settings.badgeEnabled === false) {
      clearBadgesForAllTabs();
    } else {
      refreshTrackedTabs();
    }
  }
});

function updateIcon(tabId) {
  const state = tabStates[tabId]?.status || 'WHITE';

  // ì•„ì´ì½˜ì€ ê¸°ì¡´ ë¦¬ì†ŒìŠ¤ë¥¼ ì¬ì‚¬ìš©(ë±ƒì§€ ìƒ‰ìœ¼ë¡œ êµ¬ë¶„ì´ í•µì‹¬)
  let iconPath = 'assets/bell_profile.png';

  // ë°°ì§€ëŠ” "ìƒ‰"ì´ ì¤‘ìš”. í…ìŠ¤íŠ¸ëŠ” ìˆ¨ê¸°ê¸° ìœ„í•´ '1'ì„ ì“°ê³  ê¸€ììƒ‰ì„ ë°°ê²½ê³¼ ë™ì¼í•˜ê²Œ ë§ì¶˜ë‹¤.
  // (ê³µë°±ë§Œ ë„£ìœ¼ë©´ ë±ƒì§€ê°€ ì•ˆ ëœ¨ëŠ” ë¸Œë¼ìš°ì €/í™˜ê²½ì´ ìˆì–´ ì•ˆì „ì¥ì¹˜)
  let badgeText = '1';
  let badgeBg = '#FFFFFF';
  let badgeFg = '#FFFFFF';

  switch (state) {
    case 'ORANGE':
      iconPath = 'assets/bell_pending.png';
      badgeBg = '#FFA500';
      badgeFg = '#FFA500';
      break;
    case 'GREEN':
      iconPath = 'assets/bell_unread.png';
      badgeBg = '#7CFC00'; // ì—°ë‘
      badgeFg = '#7CFC00';
      break;
    case 'WHITE':
    default:
      iconPath = 'assets/bell_profile.png';
      badgeBg = '#FFFFFF';
      badgeFg = '#FFFFFF';
      break;
  }
  // ì•„ì´ì½˜ ë° ë°°ì§€ ì ìš©
  safeActionCall(chrome.action.setIcon({ path: iconPath, tabId: tabId }));

  // ë°°ì§€ í‘œì‹œ OFFë©´ "ì™„ì „ ì œê±°" (í…ìŠ¤íŠ¸ë¥¼ ë¹„ìš°ë©´ ë°°ì§€ê°€ ì‚¬ë¼ì§)
  if (!settings.badgeEnabled) {
    safeActionCall(chrome.action.setBadgeText({ text: '', tabId: tabId }));
    return;
  }

  safeActionCall(chrome.action.setBadgeText({ text: badgeText, tabId: tabId }));
  safeActionCall(chrome.action.setBadgeBackgroundColor({ color: badgeBg, tabId: tabId }));
  // MV3: ë°°ì§€ í…ìŠ¤íŠ¸ ìƒ‰ìƒ ì§€ì • ê°€ëŠ¥(ì§€ì› ì•ˆ í•˜ë©´ ë¬´ì‹œ)
  if (chrome.action.setBadgeTextColor) {
    try {
      safeActionCall(chrome.action.setBadgeTextColor({ color: badgeFg, tabId: tabId }));
    } catch (_) {}
  }
}
chrome.runtime.onMessage.addListener((message, sender, sendResponse) => {
  if (!sender.tab) return;
  const tabId = sender.tab.id;
  if (message.action === 'status_update') {
    const prev = tabStates[tabId]?.status;
    const platform = message.platform;
    const siteName = message.siteName;
    // 1) ìƒì„±ì¤‘ì´ë©´ ë¬´ì¡°ê±´ ORANGE
    if (message.isGenerating) {
      tabStates[tabId] = { status: 'ORANGE', platform };
      updateIcon(tabId);
      return;
    }

    // 2) ìƒì„±ì´ ì•„ë‹ˆë¼ë©´:
    //    - ORANGE -> GREEN (ì™„ë£Œ)
    //    - (ì²« ë³´ê³ ) -> WHITE (ì•„ë¬´ ì§ˆë¬¸ ì—†ìŒ)
    //    - GREEN/WHITE ìœ ì§€
    if (!prev) {
      tabStates[tabId] = { status: 'WHITE', platform };
      updateIcon(tabId);
      return;
    }

    if (prev === 'ORANGE') {
      tabStates[tabId] = { status: 'GREEN', platform };
      updateIcon(tabId);

      // íƒ­ì´ í˜„ì¬ ë¹„í™œì„±ì´ë©´(ë‹¤ë¥¸ íƒ­ ë³´ê³  ìˆìœ¼ë©´) ì•Œë¦¼ì„ ë³´ë‚¼ ìˆ˜ ìˆìŒ
      chrome.tabs.query({ active: true, currentWindow: true }, (tabs) => {
        const isActiveTab = tabs.length > 0 && tabs[0].id === tabId;
        if (!isActiveTab && !settings.dndMode) sendNotification(platform, siteName);
      });
      return;
    }

    // prevê°€ GREEN/WHITEì¸ë° isGenerating=falseê°€ ì™”ë‹¤ë©´ ìƒíƒœëŠ” ê·¸ëŒ€ë¡œ ë‘”ë‹¤.
    // (ğŸŸ¢ëŠ” í´ë¦­/ìŠ¤í¬ë¡¤ ë©”ì‹œì§€ë¡œë§Œ âšªë¡œ ë°”ë€ë‹¤)
    if (prev === 'GREEN' || prev === 'WHITE') {
      // platformë§Œ ìµœì‹ ìœ¼ë¡œ ë³´ì •
      tabStates[tabId].platform = platform;
      updateIcon(tabId);
      return;
    }
  }

  // content ìª½ ì‚¬ìš©ì ìƒí˜¸ì‘ìš©(í´ë¦­/ìŠ¤í¬ë¡¤)ë¡œ ğŸŸ¢ -> âšª
  if (message.action === 'user_activity') {
    const prev = tabStates[tabId]?.status;
    if (prev === 'GREEN') {
      tabStates[tabId].status = 'WHITE';
      updateIcon(tabId);
    }
  }
});

function sendNotification(platform, siteName) {
  let title = siteName ? `${siteName} ë‹µë³€ ì™„ë£Œ` : "AI ë‹µë³€ ì™„ë£Œ";
  // í˜¸í™˜/ë°±ì—…: siteNameì´ ì—†ì„ ë•Œë§Œ í”Œë«í¼ë³„ë¡œ ì¹˜í™˜
  if (!siteName) {
    if (platform === 'chatgpt') title = "ChatGPT ë‹µë³€ ì™„ë£Œ";
    else if (platform === 'gemini') title = "Gemini ë‹µë³€ ì™„ë£Œ";
    else if (platform === 'aistudio') title = "AI Studio ë‹µë³€ ì™„ë£Œ";
    else if (platform === 'claude') title = "Claude ë‹µë³€ ì™„ë£Œ";
  }
  chrome.notifications.create({
    type: 'basic',
    iconUrl: 'assets/bell_notice.png',
    title: title,
    message: "ì‘ì—…ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤. í™•ì¸í•˜ë ¤ë©´ í´ë¦­í•˜ì„¸ìš”.",
    priority: 2
  });
}

// ì•Œë¦¼ í´ë¦­ ì‹œ í•´ë‹¹ íƒ­ìœ¼ë¡œ ì´ë™
chrome.notifications.onClicked.addListener(() => {
  const greenTabId = Object.keys(tabStates).find(id => tabStates[id].status === 'GREEN');
  if (!greenTabId) return;

  const tId = parseInt(greenTabId);
  chrome.tabs.update(tId, { active: true });
  chrome.windows.update(chrome.windows.WINDOW_ID_CURRENT, { focused: true });

  // ìš”êµ¬ì‚¬í•­: íƒ­ì„ ì—¬ëŠ” ê²ƒë§Œìœ¼ë¡œëŠ” ğŸŸ¢ë¥¼ ì—†ì• ì§€ ì•ŠëŠ”ë‹¤.
  // (í´ë¦­/ìŠ¤í¬ë¡¤ë¡œë§Œ âšªë¡œ ì „í™˜)
});

// íƒ­ ë‹«í˜ ì •ë¦¬
chrome.tabs.onRemoved.addListener((tabId) => { delete tabStates[tabId]; });

function isMonitoredUrl(url) {
  if (!url || !(url.startsWith('http://') || url.startsWith('https://'))) return false;
  const sitesApi = globalThis?.ReadyAi?.sites;
  if (!sitesApi?.resolveSiteFromConfig) return true; // fallback
  try {
    const site = sitesApi.resolveSiteFromConfig(url, _siteConfigCache.enabledSites, _siteConfigCache.customSites);
    return !!site;
  } catch (_) {
    return true;
  }
}

function purgeDisabledTabs() {
  chrome.tabs.query({}, (tabs) => {
    for (const t of tabs) {
      if (!t?.id) continue;
      if (!tabStates[t.id]) continue;
      const url = t.url || '';
      if (!url) continue;
      if (isMonitoredUrl(url)) continue;

      // ë” ì´ìƒ ë“±ë¡ëœ ì‚¬ì´íŠ¸ê°€ ì•„ë‹ˆë©´ ìƒíƒœ ì •ë¦¬ + ì•„ì´ì½˜ í°ìƒ‰ìœ¼ë¡œ
      delete tabStates[t.id];
      updateIcon(t.id);
    }
  });
}

// ì„œë¹„ìŠ¤ì›Œì»¤ ì‹œì‘ ì‹œì—ë„ í•œë²ˆ ìºì‹œ
getSiteConfig();

```

FILE: src\content.js
----------------------------------------
```js
// NOTE:
// - content scriptëŠ” <all_urls>ì— ì£¼ì…ëœë‹¤.
// - í•˜ì§€ë§Œ ì‹¤ì œ ê°ì‹œëŠ” "ë“±ë¡/í™œì„±"ëœ ì‚¬ì´íŠ¸ì—ì„œë§Œ ì‹¤í–‰í•œë‹¤.

let activeSite = null; // { key, name, detection }
let monitoring = false;

let isGenerating = false;
let checkInterval = null;
let completionStatus = 'idle'; // 'idle' | 'completed'

// ìµœì´ˆ 1íšŒëŠ” ë¬´ì¡°ê±´ backgroundë¡œ ìƒíƒœë¥¼ ë³´ë‚´ì„œ
// "ì•„ë¬´ ì§ˆë¬¸ ì—†ìŒ" ìƒíƒœ(í°ìƒ‰ ë±ƒì§€)ë„ íƒ­ì— ì¦‰ì‹œ ë°˜ì˜ë˜ê²Œ í•œë‹¤.
let hasSentInitialState = false;

// íƒ­ íƒ€ì´í‹€ ë±ƒì§€(ì´ëª¨ì§€)
const TITLE_BADGE = {
  WHITE: 'âšª',  // ëŒ€ê¸°/ì½ìŒ/ì•„ë¬´ ì§ˆë¬¸ ì—†ìŒ
  ORANGE: 'ğŸŸ ', // ìƒì„±ì¤‘
  GREEN: 'ğŸŸ¢',  // ì™„ë£Œ(ì•„ì§ í´ë¦­/ìŠ¤í¬ë¡¤ë¡œ í™•ì¸ ì „)
};

// ===== ë°±ê·¸ë¼ìš´ë“œ íƒ­ì—ì„œë„ ì™„ë£Œ ê°ì§€(íŠ¹íˆ Gemini) =====
// - GeminiëŠ” DOM ë³€ê²½ì´ childListê°€ ì•„ë‹ˆë¼ attributes/styleë¡œë§Œ ì¼ì–´ë‚˜ëŠ” ê²½ìš°ê°€ ìˆì–´
//   MutationObserver(childList)ë§Œìœ¼ë¡œëŠ” "ì¤‘ì§€ ë²„íŠ¼ ì‚¬ë¼ì§"ì„ ëª» ì¡ê³  ğŸŸ ê°€ ìœ ì§€ë  ìˆ˜ ìˆìŒ.
// - ë”°ë¼ì„œ attributes ê°ì‹œ + ì£¼ê¸° í´ë§(setInterval)ì„ ê°™ì´ ì‚¬ìš©í•œë‹¤.
const CHECK_INTERVAL_MS = 1200;
const MIN_CHECK_GAP_MS = 250;

let _checkScheduled = false;
let _lastCheckAt = 0;

function scheduleCheck() {
  if (!monitoring) return;
  if (_checkScheduled) return;
  _checkScheduled = true;

  const now = Date.now();
  const delay = Math.max(0, MIN_CHECK_GAP_MS - (now - _lastCheckAt));

  setTimeout(() => {
    _checkScheduled = false;
    _lastCheckAt = Date.now();
    try {
      checkStatus();
    } catch (e) {
      // content scriptê°€ ì£½ì–´ë²„ë¦¬ë©´ ì´í›„ ìƒíƒœ ê°±ì‹ ì´ ëª¨ë‘ ë©ˆì¶”ë¯€ë¡œ ì˜ˆì™¸ëŠ” ì‚¼í‚´
      // (í•„ìš”í•˜ë©´ ì•„ë˜ ë¼ì¸ ì£¼ì„ í•´ì œ)
      // console.debug('[Ready_Ai] checkStatus failed', e);
    }
  }, delay);
}

function ensurePolling() {
  if (!monitoring) return;
  if (checkInterval) return;
  checkInterval = window.setInterval(() => {
    scheduleCheck();
  }, CHECK_INTERVAL_MS);
}

// ë‹¨ìˆœ ì…€ë ‰í„° ì œê±° -> ì•„ë˜ checkStatus í•¨ìˆ˜ ë‚´ì—ì„œ ë¡œì§ìœ¼ë¡œ ì²˜ë¦¬

// ìš”ì†Œê°€ ì‹¤ì œë¡œ í™”ë©´ì— ë³´ì´ëŠ”ì§€ í™•ì¸í•˜ëŠ” í—¬í¼ í•¨ìˆ˜

// ==========================
// DOM íƒìƒ‰/ê°ì‹œ ìœ í‹¸
// ==========================
// GeminiëŠ” ì™„ë£Œ í›„ì—ë„ Stop ë²„íŠ¼ì´ DOMì— ë‚¨ì•„ìˆë˜
// opacity/visibility/disabledë§Œ ë°”ë€ŒëŠ” ê²½ìš°ê°€ ìˆì–´ì„œ
// ë‹¨ìˆœ offsetWidth/offsetHeightë§Œìœ¼ë¡œëŠ” "ë³´ì„" íŒì •ì´ í‹€ë¦´ ìˆ˜ ìˆë‹¤.
function isVisible(elem) {
  if (!elem) return false;
  // hidden ì†ì„±
  if (elem.hasAttribute && elem.hasAttribute('hidden')) return false;

  // computed style ê¸°ë°˜
  let style;
  try {
    style = window.getComputedStyle(elem);
  } catch (_) {
    // getComputedStyleì´ ì‹¤íŒ¨í•˜ë©´ ìµœì†Œí•œì˜ DOM ê¸°ë°˜ íŒì •ë§Œ ìˆ˜í–‰
    return !!(elem.offsetWidth || elem.offsetHeight || elem.getClientRects().length);
  }

  if (!style) return false;
  if (style.display === 'none') return false;
  if (style.visibility === 'hidden' || style.visibility === 'collapse') return false;
  if (parseFloat(style.opacity || '1') === 0) return false;

  // ë ˆì´ì•„ì›ƒ/ë Œë” ì‚¬ê°í˜•
  const rect = elem.getBoundingClientRect ? elem.getBoundingClientRect() : null;
  if (rect && (rect.width <= 0 || rect.height <= 0)) return false;

  // ë§ˆì§€ë§‰ ì•ˆì „ì¥ì¹˜
  return !!(elem.offsetWidth || elem.offsetHeight || elem.getClientRects().length);
}

function isEnabledButtonLike(elem) {
  if (!elem) return false;
  // disabled / aria-disabled / role=button/ë²„íŠ¼ë¥˜ ê³µí†µ ì¼€ì´ìŠ¤
  if (elem.disabled === true) return false;
  const ariaDisabled = elem.getAttribute ? elem.getAttribute('aria-disabled') : null;
  if (ariaDisabled && ariaDisabled.toLowerCase() === 'true') return false;
  return true;
}

// ===== Shadow DOM(ì˜¤í”ˆ) ëŒ€ì‘ =====
// - Gemini UIëŠ” open shadowRoot ì•„ë˜ì— ì£¼ìš” ë²„íŠ¼ì´ ë“¤ì–´ê°€ëŠ” ê²½ìš°ê°€ ìˆì–´
//   document.querySelectorAllë§Œìœ¼ë¡œëŠ” Stop ë²„íŠ¼ ë³€í™”ë¥¼ ë†“ì¹  ìˆ˜ ìˆë‹¤.
// - ë”°ë¼ì„œ "ì•Œë ¤ì§„ rootë“¤(document + open shadow roots)" ì— ëŒ€í•´
//   (1) deep query
//   (2) deep mutation observe
// ë¥¼ í•¨ê»˜ ì‚¬ìš©í•œë‹¤.
const _deepRoots = new Set(); // Document | ShadowRoot
const _deepObservers = new Map(); // root -> MutationObserver
let _lastShadowRescanAt = 0;
const SHADOW_RESCAN_MS = 4000;

function addDeepRoot(root) {
  if (!root) return;
  if (_deepRoots.has(root)) return;
  _deepRoots.add(root);
  attachObserver(root);
  // ë°©ê¸ˆ ì¶”ê°€ëœ shadowRoot ë‚´ë¶€ì—ë„ ë˜ ë‹¤ë¥¸ shadowRootê°€ ìˆì„ ìˆ˜ ìˆìœ¼ë¯€ë¡œ
  // 1íšŒ ìŠ¤ìº”í•´ì„œ ê¹Šì€ êµ¬ì¡°ë¥¼ ì´ˆê¸°ì— ì¡ì•„ë‘”ë‹¤.
  try {
    scanTreeForShadowRoots(root);
  } catch (_) {}
}

function attachObserver(root) {
  if (!root) return;
  if (_deepObservers.has(root)) return;

  const obs = new MutationObserver((mutationList) => {
    // ìƒˆë¡œ ìƒê¸´ shadowRootë¥¼ ì¶”ê°€ë¡œ ë“±ë¡
    for (const m of mutationList) {
      if (m.addedNodes && m.addedNodes.length) {
        for (const n of m.addedNodes) {
          scanTreeForShadowRoots(n);
        }
      }
    }
    scheduleCheck();
  });

  // Document/ShadowRoot ëª¨ë‘ observe ê°€ëŠ¥
  try {
    const target = root === document ? document.body : root;
    if (!target) return;
    obs.observe(target, {
      childList: true,
      subtree: true,
      attributes: true,
      // GeminiëŠ” style/class/aria-label ë³€ê²½ë§Œìœ¼ë¡œ UIê°€ ë°”ë€Œê¸°ë„ í•¨
      attributeFilter: ['aria-label', 'style', 'class', 'hidden', 'disabled', 'aria-disabled']
    });
    _deepObservers.set(root, obs);
  } catch (_) {
    // observe ì‹¤íŒ¨ ì‹œ(íŠ¹ì • rootê°€ ë” ì´ìƒ ìœ íš¨í•˜ì§€ ì•Šì€ ê²½ìš° ë“±) ë¬´ì‹œ
  }
}

function scanTreeForShadowRoots(rootNode) {
  if (!rootNode) return;

  // Documentë¥¼ ë„˜ê²¨ë„ ì•ˆì „í•˜ê²Œ ì²˜ë¦¬
  let start = rootNode;
  if (start === document) start = document.documentElement;
  if (!start) return;

  const stack = [];

  // (1) Element ìì‹ ë„ ê²€ì‚¬ ëŒ€ìƒ
  if (start.nodeType === Node.ELEMENT_NODE) stack.push(start);

  // (2) ShadowRoot/DocumentFragment ê°™ì€ ê²½ìš°ì—ëŠ” í•˜ìœ„ elementë¶€í„° íƒìƒ‰
  //     (shadowRootëŠ” childrenì„ ì œê³µí•˜ëŠ” ê²½ìš°ê°€ ë§ì§€ë§Œ, ì•ˆì „í•˜ê²Œ childNodesë„ ì²˜ë¦¬)
  const seedChildren = start.children || start.childNodes;
  if (seedChildren && seedChildren.length) {
    for (let i = 0; i < seedChildren.length; i++) {
      const n = seedChildren[i];
      if (n && n.nodeType === Node.ELEMENT_NODE) stack.push(n);
    }
  }

  while (stack.length) {
    const el = stack.pop();
    if (!el || el.nodeType !== Node.ELEMENT_NODE) continue;

    if (el.shadowRoot) addDeepRoot(el.shadowRoot);

    const kids = el.children;
    if (kids && kids.length) {
      for (let i = 0; i < kids.length; i++) stack.push(kids[i]);
    }
  }
}

function maybeRescanShadowRoots() {
  const now = Date.now();
  if (now - _lastShadowRescanAt < SHADOW_RESCAN_MS) return;
  _lastShadowRescanAt = now;
  try {
    scanTreeForShadowRoots(document.documentElement);
  } catch (_) {}
}

function initDeepRoots() {
  addDeepRoot(document);
  // ìµœì´ˆ 1íšŒ: ë¬¸ì„œ ì „ì²´ì—ì„œ open shadowRoot ìˆ˜ì§‘
  try {
    scanTreeForShadowRoots(document.documentElement);
  } catch (_) {}
}

function deepQuerySelectorAll(selector) {
  const out = [];
  for (const root of _deepRoots) {
    try {
      out.push(...Array.from(root.querySelectorAll(selector)));
    } catch (_) {}
  }
  return out;
}

function getSiteKey() {
  return activeSite?.key || null;
}

// íƒ­ ì œëª©(Title)ì— ë°°ì§€(ì´ëª¨ì§€) ë‹¬ê¸° - ì•„ì´ì½˜ ë°”ë¡œ ì˜†ì— í‘œì‹œë¨
function updateTitleBadge() {
  if (!monitoring) return;
  // 1. í˜„ì¬ ì œëª© ê°€ì ¸ì˜¤ê¸°
  const currentTitle = document.title;
  // 2. ì œëª© ì•ì˜ âšª/ğŸŸ /ğŸŸ¢ ë°°ì§€ ë° ê³µë°±ì„ ëª¨ë‘ ì œê±°í•˜ì—¬ ìˆœìˆ˜ ì œëª© ì¶”ì¶œ
  // (ì •ê·œì‹: ì¤„ ì‹œì‘(^)ì— ìˆëŠ” ë°°ì§€ ì´ëª¨ì§€ì™€ ê³µë°±(\s?)ì´ í•˜ë‚˜ ì´ìƒ(+) ìˆëŠ” ê²½ìš°)
  const cleanTitle = currentTitle.replace(/^([âšªğŸŸ ğŸŸ¢]\s?)+/, "");

  // 3. ìƒíƒœì— ë”°ë¥¸ ëª©í‘œ ì œëª© ìƒì„±
  let badge = TITLE_BADGE.WHITE;
  if (isGenerating) badge = TITLE_BADGE.ORANGE;
  else if (completionStatus === 'completed') badge = TITLE_BADGE.GREEN;

  const targetTitle = `${badge} ${cleanTitle}`;
  // 4. í˜„ì¬ ì œëª©ì´ ëª©í‘œì™€ ë‹¤ë¥¼ ë•Œë§Œ ë³€ê²½ (ì´ ë¹„êµê°€ ë¬´í•œ ë£¨í”„ë¥¼ ë§‰ì•„ì¤Œ)
  if (currentTitle !== targetTitle) {
    document.title = targetTitle;
  }
}

function clearTitleBadge() {
  const currentTitle = document.title;
  const cleanTitle = currentTitle.replace(/^([âšªğŸŸ ğŸŸ¢]\s?)+/, "");
  if (cleanTitle !== currentTitle) document.title = cleanTitle;
}

// =========================
// Generating detection rules
// =========================
function detectChatGPTGenerating() {
  const btn = document.querySelector('[data-testid="stop-button"]');
  return isVisible(btn);
}

function detectGeminiGenerating() {
  // Gemini: "ì¤‘ì§€" ë˜ëŠ” "Stop" ë‹¨ì–´ê°€ ë“¤ì–´ê°„ ë²„íŠ¼ì´ í™”ë©´ì— ë³´ì´ëŠ”ì§€ í™•ì¸
  const btns = document.querySelectorAll('[aria-label*="ì¤‘ì§€"], [aria-label*="Stop"], [aria-label*="stop"]');
  return Array.from(btns).some((btn) => isVisible(btn));
}

function detectAiStudioGenerating() {
  // AI Studio:
  // 1. Google Material Icon ìì²´ê°€ 'stop', 'cancel', 'block' ì¸ì§€ í™•ì¸ (ê°€ì¥ í™•ì‹¤í•¨)
  const icons = Array.from(document.querySelectorAll('mat-icon'));
  const hasStopIcon = icons.some((icon) => {
    const iconName = icon.innerText.trim().toLowerCase();
    return ['stop', 'cancel', 'block', 'close'].includes(iconName) && isVisible(icon);
  });
  // 2. ë¡œë”©ë°” í™•ì¸
  const progressBar = document.querySelector('mat-progress-bar');
  return hasStopIcon || isVisible(progressBar);
}

function detectClaudeGenerating() {
  // Claude: ë²„íŠ¼ í…ìŠ¤íŠ¸ì— "Stop"ì´ í¬í•¨ë˜ì–´ ìˆëŠ”ì§€ í™•ì¸
  const buttons = Array.from(document.querySelectorAll('button, div[role="button"]'));
  return buttons.some((btn) => btn.innerText.includes('Stop') && isVisible(btn));
}

function detectGenericStopGenerating() {
  // ë²”ìš©: Stop/ì¤‘ì§€/Cancel/ì·¨ì†Œ/Abort í…ìŠ¤íŠ¸ or aria-label ê¸°ë°˜
  // (ë“±ë¡ëœ ì‚¬ì´íŠ¸ì—ì„œë§Œ ì“°ì´ë¯€ë¡œ, ë„ˆë¬´ ê³µê²©ì ìœ¼ë¡œ ì¡ì§€ ì•ŠëŠ”ë‹¤)
  const STOP_RE = /(\bstop\b|\bcancel\b|\babort\b|ì¤‘ì§€|ì·¨ì†Œ)/i;

  const candidates = Array.from(document.querySelectorAll('button, [role="button"]'));
  for (const el of candidates) {
    if (!isVisible(el)) continue;
    const aria = (el.getAttribute('aria-label') || '').trim();
    const txt = (el.innerText || '').trim();
    const hay = `${aria} ${txt}`.trim();
    if (!hay) continue;
    if (STOP_RE.test(hay)) return true;
  }
  return false;
}

function detectGenerating(site) {
  const mode = site?.detection || 'generic_stop';
  if (mode === 'chatgpt') return detectChatGPTGenerating();
  if (mode === 'gemini') return detectGeminiGenerating();
  if (mode === 'aistudio') return detectAiStudioGenerating();
  if (mode === 'claude') return detectClaudeGenerating();
  return detectGenericStopGenerating();
}

function checkStatus() {
  if (!monitoring || !activeSite) return;

  const platform = activeSite.key;
  let currentlyGenerating = false;

  try {
    currentlyGenerating = detectGenerating(activeSite);
  } catch (_) {
    currentlyGenerating = false;
  }

  // ìƒíƒœê°€ ë³€í–ˆì„ ë•Œë§Œ ì²˜ë¦¬
  if (isGenerating !== currentlyGenerating) {
    isGenerating = currentlyGenerating;

    // ìš”êµ¬ì‚¬í•­:
    // - ìƒì„± ì‹œì‘: âšª -> ğŸŸ 
    // - ìƒì„± ì™„ë£Œ: ğŸŸ  -> ğŸŸ¢ (íƒ­ì´ í¬ì»¤ìŠ¤ì¸ì§€ ì—¬ë¶€ì™€ ë¬´ê´€í•˜ê²Œ ë¬´ì¡°ê±´ ğŸŸ¢)
    // - ğŸŸ¢ ìƒíƒœëŠ” "í´ë¦­/ìŠ¤í¬ë¡¤"ë¡œë§Œ âšªë¡œ ëŒì•„ê°„ë‹¤.
    if (isGenerating) {
      completionStatus = 'idle';
    } else {
      completionStatus = 'completed';
    }

    chrome.runtime.sendMessage({
      action: "status_update",
      platform,
      siteName: activeSite.name,
      isGenerating,
    });
    hasSentInitialState = true;
  } else if (!hasSentInitialState) {
    // ì´ˆê¸° 1íšŒëŠ” ë¬´ì¡°ê±´ ìƒíƒœ ì „ì†¡(í°ìƒ‰ ë±ƒì§€ í‘œì‹œìš©)
    chrome.runtime.sendMessage({
      action: "status_update",
      platform,
      siteName: activeSite.name,
      isGenerating,
    });
    hasSentInitialState = true;
  }
  
  // ë£¨í”„ë§ˆë‹¤ ë°°ì§€ ìƒíƒœ ê°•ì œ ë™ê¸°í™” (ì‚¬ì´íŠ¸ê°€ ì œëª©ì„ ë°”ê¿”ë„ ë‹¤ì‹œ ë®ì–´ì”€)
  updateTitleBadge();
}

// ì‚¬ìš©ì ìƒí˜¸ì‘ìš©(í´ë¦­/ìŠ¤í¬ë¡¤) ì‹œ ğŸŸ¢ -> âšª ì „í™˜ (ìš”êµ¬ì‚¬í•­)
function markAsAcknowledged() {
  if (!monitoring) return;
  if (isGenerating) return;
  if (completionStatus !== 'completed') return;

  completionStatus = 'idle';
  updateTitleBadge();

  // background(íˆ´ë°” ë°°ì§€)ë„ ê°™ì´ âšªë¡œ ë°”ê¿”ì¤€ë‹¤.
  chrome.runtime.sendMessage({
    action: 'user_activity',
    platform: getSiteKey(),
    siteName: activeSite?.name,
    kind: 'ack'
  });
}

// =========================
// Monitor lifecycle (start/stop) - registered sites only
// =========================
let _observer = null;
let _handlersBound = false;

function bindHandlersOnce() {
  if (_handlersBound) return;
  _handlersBound = true;
  // ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ë“±ë¡
  // - focus/keydownìœ¼ë¡œëŠ” ì ˆëŒ€ ì§€ìš°ì§€ ì•ŠëŠ”ë‹¤.
  // - "í´ë¦­" ë˜ëŠ” "ìŠ¤í¬ë¡¤(íœ /ìŠ¤í¬ë¡¤ ì´ë²¤íŠ¸)"ë¡œë§Œ ğŸŸ¢ -> âšª
  document.addEventListener('click', markAsAcknowledged, true);
  document.addEventListener('scroll', markAsAcknowledged, true);
  document.addEventListener('wheel', markAsAcknowledged, { passive: true, capture: true });
  // íƒ­ í™œì„±/ë¹„í™œì„± ì „í™˜ ì‹œì—ë„ ìƒíƒœ ì¬í‰ê°€(ë°±ê·¸ë¼ìš´ë“œ ì™„ë£Œ ê°ì§€ ë³´ê°•)
  document.addEventListener('visibilitychange', scheduleCheck);
}

function startMonitoring(site) {
  if (monitoring && activeSite?.key === site?.key) return;

  stopMonitoring();
  activeSite = site;
  monitoring = true;
  isGenerating = false;
  completionStatus = 'idle';
  hasSentInitialState = false;

  bindHandlersOnce();

  // DOM ë³€í™”ë¥¼ ê°ì§€í•˜ì—¬ ì²´í¬ ì‹¤í–‰
  _observer = new MutationObserver(() => {
    scheduleCheck();
  });
  try {
    _observer.observe(document.body, {
      childList: true,
      subtree: true,
      // GeminiëŠ” childList ë³€í™” ì—†ì´ style/class/aria-labelë§Œ ë°”ë€ŒëŠ” ê²½ìš°ê°€ ìˆì–´
      // attributes ê°ì‹œë¥¼ ì¼œì•¼ ğŸŸ  -> ğŸŸ¢ ì „í™˜ì„ ë†“ì¹˜ì§€ ì•ŠëŠ”ë‹¤.
      attributes: true,
      attributeFilter: ['aria-label', 'style', 'class', 'hidden', 'disabled']
    });
  } catch (_) {
    // ì¼ë¶€ ë¬¸ì„œ(íŠ¹ìˆ˜ í”„ë ˆì„)ì—ì„œëŠ” observe ì‹¤íŒ¨í•  ìˆ˜ ìˆìŒ
  }

  ensurePolling();
  scheduleCheck();
}

function stopMonitoring() {
  monitoring = false;
  activeSite = null;
  isGenerating = false;
  completionStatus = 'idle';
  hasSentInitialState = false;

  if (checkInterval) {
    clearInterval(checkInterval);
    checkInterval = null;
  }
  if (_observer) {
    try { _observer.disconnect(); } catch (_) {}
    _observer = null;
  }
  clearTitleBadge();
}

function refreshSiteFromStorage() {
  if (!window?.ReadyAi?.sites) return;

  chrome.storage.local.get([
    window.ReadyAi.sites.STORAGE_KEYS.ENABLED_SITES,
    window.ReadyAi.sites.STORAGE_KEYS.CUSTOM_SITES,
  ], (res) => {
    const enabledSites = window.ReadyAi.sites.ensureEnabledSitesObject(res?.enabledSites);
    const customSites = window.ReadyAi.sites.normalizeCustomSites(res?.customSites);
    const site = window.ReadyAi.sites.resolveSiteFromConfig(window.location.href, enabledSites, customSites);
    if (site) startMonitoring(site);
    else stopMonitoring();
  });
}

// ì„¤ì • ë³€ê²½ ì‹œ(íŒì—…ì—ì„œ ì‚¬ì´íŠ¸ on/off ë˜ëŠ” custom ì¶”ê°€/ì‚­ì œ) ì¦‰ì‹œ ë°˜ì˜
try {
  chrome.storage.onChanged.addListener((changes, area) => {
    if (area !== 'local') return;
    if (changes.enabledSites || changes.customSites) refreshSiteFromStorage();
  });
} catch (_) {}

refreshSiteFromStorage();
console.log('[Ready_Ai] content script loaded');

```

FILE: src\popup.html
----------------------------------------
```html
<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <style>
    body { width: 320px; padding: 15px; font-family: 'Segoe UI', sans-serif; }
    .header { display: flex; align-items: center; gap: 10px; margin-bottom: 20px; }
    .header img { width: 24px; height: 24px; }
    .header h2 { margin: 0; font-size: 16px; }
    .option { display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px; }
    .desc { font-size: 11px; color: #666; line-height: 1.4; }
    .divider { height: 1px; background: #e6e6e6; margin: 14px 0; }
    .section-title { font-size: 13px; font-weight: 600; margin: 0 0 8px 0; }
    .site-list { display: flex; flex-direction: column; gap: 8px; }
    .site-row { display: flex; justify-content: space-between; align-items: center; gap: 10px; }
    .site-left { display: flex; flex-direction: column; gap: 2px; min-width: 0; }
    .site-name { font-size: 12px; font-weight: 600; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
    .site-sub { font-size: 10px; color: #888; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }

    .custom-form { display: flex; flex-direction: column; gap: 8px; }
    .field { display: flex; flex-direction: column; gap: 4px; }
    .field label { font-size: 11px; color: #555; }
    input[type="text"], textarea, select {
      font-size: 12px;
      padding: 6px 8px;
      border: 1px solid #ccc;
      border-radius: 8px;
      outline: none;
    }
    textarea { resize: vertical; min-height: 46px; }
    .row-actions { display: flex; gap: 8px; }
    .btn {
      border: 1px solid #ccc;
      background: #fff;
      border-radius: 10px;
      padding: 6px 10px;
      font-size: 12px;
      cursor: pointer;
    }
    .btn.primary { border-color: #FFA500; }
    .btn.danger { border-color: #ff6b6b; color: #b00000; }
    .hint { font-size: 10px; color: #888; line-height: 1.35; }
    .scroll { max-height: 520px; overflow: auto; padding-right: 4px; }
    /* Toggle Switch Style */
    .switch { position: relative; display: inline-block; width: 34px; height: 20px; }
    .switch input { opacity: 0; width: 0; height: 0; }
    .slider { position: absolute; cursor: pointer; top: 0; left: 0; right: 0; bottom: 0; background-color: #ccc; transition: .4s; border-radius: 34px; }
    .slider:before { position: absolute; content: ""; height: 14px; width: 14px; left: 3px; bottom: 3px; background-color: white; transition: .4s; border-radius: 50%; }
    input:checked + .slider { background-color: #FFA500; }
    input:checked + .slider:before { transform: translateX(14px); }
  </style>
</head>
<body>
  <div class="scroll">
    <div class="header">
      <img src="../assets/bell_profile.png" alt="Logo">
      <h2>Ready_Ai</h2>
    </div>

    <div class="option">
      <span>ë°©í•´ ê¸ˆì§€ ëª¨ë“œ ğŸŒ™</span>
      <label class="switch">
        <input type="checkbox" id="dnd-toggle">
        <span class="slider"></span>
      </label>
    </div>
    <div class="desc">í™œì„±í™” ì‹œ ì™„ë£Œ ì•Œë¦¼ íŒì—…ì´ ëœ¨ì§€ ì•ŠìŠµë‹ˆë‹¤. (ì•„ì´ì½˜ ë°°ì§€ëŠ” ê³„ì† í‘œì‹œë¨)</div>

    <div class="divider"></div>

    <div class="section-title">ì‚¬ì´íŠ¸ ë“±ë¡(ê¸°ë³¸)</div>
    <div class="site-list" id="builtin-sites"></div>

    <div class="divider"></div>

    <div class="section-title">ì‚¬ì´íŠ¸ ë“±ë¡(ì§ì ‘ ì¶”ê°€)</div>
    <div class="site-list" id="custom-sites"></div>
    <div class="hint" style="margin: 8px 0 10px 0;">
      URL íŒ¨í„´ì€ í¬ë¡¬ ë§¤ì¹˜íŒ¨í„´ìœ¼ë¡œ ì…ë ¥í•´. ì˜ˆ: <b>https://example.com/*</b> ë˜ëŠ” <b>https://*.example.com/*</b><br>
      ì—¬ëŸ¬ ê°œëŠ” ì¤„ë°”ê¿ˆìœ¼ë¡œ ì¶”ê°€ ê°€ëŠ¥.
    </div>

    <div class="custom-form">
      <div class="field">
        <label>ì´ë¦„</label>
        <input type="text" id="custom-name" placeholder="ì˜ˆ: Perplexity(íšŒì‚¬)" />
      </div>
      <div class="field">
        <label>URL íŒ¨í„´(ì—¬ëŸ¬ ì¤„ ê°€ëŠ¥)</label>
        <textarea id="custom-patterns" placeholder="https://example.com/*"></textarea>
      </div>
      <div class="field">
        <label>ìƒì„±ì¤‘ ê°ì§€ ë°©ì‹</label>
        <select id="custom-detection"></select>
      </div>
      <div class="row-actions">
        <button class="btn primary" id="add-custom">ì¶”ê°€</button>
        <button class="btn" id="reset-defaults">ê¸°ë³¸ê°’ ë³µêµ¬</button>
      </div>
      <div class="hint" id="status-hint"></div>
    </div>
  </div>

  <script src="sites.js"></script>
  <script src="popup.js"></script>
</body>
</html>

```

FILE: src\popup.js
----------------------------------------
```js
function $(id) {
  return document.getElementById(id);
}

function setHint(text, isError = false) {
  const el = $('status-hint');
  if (!el) return;
  el.textContent = text || '';
  el.style.color = isError ? '#b00000' : '#888';
}

function getSitesApi() {
  return window?.ReadyAi?.sites;
}

function loadConfig(cb) {
  const sitesApi = getSitesApi();
  const enabledKey = sitesApi?.STORAGE_KEYS?.ENABLED_SITES || 'enabledSites';
  const customKey = sitesApi?.STORAGE_KEYS?.CUSTOM_SITES || 'customSites';

  chrome.storage.local.get(['dndMode', enabledKey, customKey], (res) => {
    const enabledSites = sitesApi?.ensureEnabledSitesObject
      ? sitesApi.ensureEnabledSitesObject(res?.[enabledKey])
      : (res?.[enabledKey] || {});
    const customSites = sitesApi?.normalizeCustomSites
      ? sitesApi.normalizeCustomSites(res?.[customKey])
      : (res?.[customKey] || []);

    cb({
      dndMode: !!res.dndMode,
      enabledSites,
      customSites,
    });
  });
}

function saveConfig(cfg, cb) {
  const sitesApi = getSitesApi();
  const enabledKey = sitesApi?.STORAGE_KEYS?.ENABLED_SITES || 'enabledSites';
  const customKey = sitesApi?.STORAGE_KEYS?.CUSTOM_SITES || 'customSites';
  chrome.storage.local.set(
    {
      dndMode: !!cfg.dndMode,
      [enabledKey]: cfg.enabledSites,
      [customKey]: cfg.customSites,
    },
    () => cb?.()
  );
}

function renderBuiltinSites(cfg) {
  const sitesApi = getSitesApi();
  const container = $('builtin-sites');
  if (!container || !sitesApi?.BUILTIN_SITES) return;

  container.innerHTML = '';

  for (const s of sitesApi.BUILTIN_SITES) {
    const row = document.createElement('div');
    row.className = 'site-row';

    const left = document.createElement('div');
    left.className = 'site-left';

    const name = document.createElement('div');
    name.className = 'site-name';
    name.textContent = s.name;

    const sub = document.createElement('div');
    sub.className = 'site-sub';
    sub.textContent = (s.patterns || []).join(' , ');

    left.appendChild(name);
    left.appendChild(sub);

    const switchWrap = document.createElement('label');
    switchWrap.className = 'switch';

    const input = document.createElement('input');
    input.type = 'checkbox';
    input.checked = !!cfg.enabledSites?.[s.key];

    const slider = document.createElement('span');
    slider.className = 'slider';

    input.addEventListener('change', () => {
      cfg.enabledSites[s.key] = input.checked;
      saveConfig(cfg, () => {
        setHint('ì €ì¥ë¨');
      });
    });

    switchWrap.appendChild(input);
    switchWrap.appendChild(slider);

    row.appendChild(left);
    row.appendChild(switchWrap);
    container.appendChild(row);
  }
}

function renderCustomSites(cfg) {
  const sitesApi = getSitesApi();
  const container = $('custom-sites');
  if (!container || !sitesApi) return;

  container.innerHTML = '';
  const customSites = Array.isArray(cfg.customSites) ? cfg.customSites : [];

  if (!customSites.length) {
    const empty = document.createElement('div');
    empty.className = 'desc';
    empty.textContent = 'ì§ì ‘ ì¶”ê°€í•œ ì‚¬ì´íŠ¸ê°€ ì—†ìŠµë‹ˆë‹¤.';
    container.appendChild(empty);
    return;
  }

  for (const s of customSites) {
    const row = document.createElement('div');
    row.className = 'site-row';

    const left = document.createElement('div');
    left.className = 'site-left';

    const name = document.createElement('div');
    name.className = 'site-name';
    name.textContent = s.name;

    const modeLabel = sitesApi.DETECTION_MODES?.find((m) => m.key === s.detection)?.label || s.detection;
    const sub = document.createElement('div');
    sub.className = 'site-sub';
    sub.textContent = `${modeLabel} Â· ${(s.patterns || []).join(' , ')}`;

    left.appendChild(name);
    left.appendChild(sub);

    const actions = document.createElement('div');
    actions.style.display = 'flex';
    actions.style.alignItems = 'center';
    actions.style.gap = '8px';

    const switchWrap = document.createElement('label');
    switchWrap.className = 'switch';

    const input = document.createElement('input');
    input.type = 'checkbox';
    input.checked = !!s.enabled;
    const slider = document.createElement('span');
    slider.className = 'slider';
    input.addEventListener('change', () => {
      s.enabled = input.checked;
      saveConfig(cfg, () => setHint('ì €ì¥ë¨'));
    });
    switchWrap.appendChild(input);
    switchWrap.appendChild(slider);

    const del = document.createElement('button');
    del.className = 'btn danger';
    del.textContent = 'ì‚­ì œ';
    del.addEventListener('click', () => {
      cfg.customSites = cfg.customSites.filter((x) => x.id !== s.id);
      saveConfig(cfg, () => {
        setHint('ì‚­ì œë¨');
        renderCustomSites(cfg);
      });
    });

    actions.appendChild(switchWrap);
    actions.appendChild(del);

    row.appendChild(left);
    row.appendChild(actions);
    container.appendChild(row);
  }
}

function renderDetectionOptions() {
  const sitesApi = getSitesApi();
  const select = $('custom-detection');
  if (!select || !sitesApi?.DETECTION_MODES) return;

  select.innerHTML = '';
  for (const m of sitesApi.DETECTION_MODES) {
    const opt = document.createElement('option');
    opt.value = m.key;
    opt.textContent = m.label;
    select.appendChild(opt);
  }
  select.value = 'generic_stop';
}

function wireActions(cfg) {
  const dndToggle = $('dnd-toggle');
  dndToggle.checked = !!cfg.dndMode;
  dndToggle.addEventListener('change', () => {
    cfg.dndMode = dndToggle.checked;
    saveConfig(cfg, () => setHint('ì €ì¥ë¨'));
  });

  $('add-custom').addEventListener('click', () => {
    const sitesApi = getSitesApi();
    if (!sitesApi) return;

    const name = String($('custom-name').value || '').trim();
    const rawPatterns = $('custom-patterns').value;
    const patterns = sitesApi.normalizePatterns(rawPatterns);
    const detection = String($('custom-detection').value || 'generic_stop').trim();

    if (!name) {
      setHint('ì´ë¦„ì„ ì…ë ¥í•´ì¤˜', true);
      return;
    }
    if (!patterns.length) {
      setHint('URL íŒ¨í„´ì„ 1ê°œ ì´ìƒ ì…ë ¥í•´ì¤˜', true);
      return;
    }

    const bad = patterns.find((p) => !sitesApi.isProbablyValidMatchPattern(p));
    if (bad) {
      setHint(`URL íŒ¨í„´ í˜•ì‹ì´ ì´ìƒí•¨: ${bad}`, true);
      return;
    }

    const id = sitesApi.makeCustomId();
    cfg.customSites = [...(cfg.customSites || []), { id, name, patterns, detection, enabled: true }];
    saveConfig(cfg, () => {
      $('custom-name').value = '';
      $('custom-patterns').value = '';
      $('custom-detection').value = 'generic_stop';
      setHint('ì¶”ê°€ë¨');
      renderCustomSites(cfg);
    });
  });

  $('reset-defaults').addEventListener('click', () => {
    const sitesApi = getSitesApi();
    if (!sitesApi) return;
    cfg.enabledSites = sitesApi.defaultEnabledSites();
    cfg.customSites = [];
    saveConfig(cfg, () => {
      setHint('ê¸°ë³¸ê°’ìœ¼ë¡œ ë³µêµ¬ë¨');
      renderBuiltinSites(cfg);
      renderCustomSites(cfg);
    });
  });
}

document.addEventListener('DOMContentLoaded', () => {
  renderDetectionOptions();
  loadConfig((cfg) => {
    setHint('');
    renderBuiltinSites(cfg);
    renderCustomSites(cfg);
    wireActions(cfg);
  });
});

```

FILE: src\sites.js
----------------------------------------
```js
// Ready_Ai - Site registry (built-in + custom)
//
// ëª©í‘œ:
// - íŒì—…ì—ì„œ "ì—¬ëŸ¬ ì‚¬ì´íŠ¸ ë“±ë¡"ì„ ê°€ëŠ¥í•˜ê²Œ í•œë‹¤.
// - content scriptëŠ” <all_urls>ì— ì£¼ì…ë˜ì§€ë§Œ, ì‹¤ì œë¡œëŠ” "ë“±ë¡/í™œì„±"ëœ ì‚¬ì´íŠ¸ì—ì„œë§Œ
//   ê°ì‹œ(í´ë§/MutationObserver/íƒ€ì´í‹€ ë±ƒì§€)ë¥¼ ì‹¤í–‰í•œë‹¤.
// - ë“±ë¡í•œ ì‚¬ì´íŠ¸ê°€ ëŠ˜ì–´ë‚˜ë„, ì—¬ê¸°ë§Œ ê±´ë“œë¦¬ë©´ UI/ê°ì‹œ ë¡œì§ì´ ê°™ì´ í™•ì¥ë˜ê²Œ í•œë‹¤.

(function () {
  const STORAGE_KEYS = {
    DND_MODE: 'dndMode',
    ENABLED_SITES: 'enabledSites',
    CUSTOM_SITES: 'customSites',
  };

  // detection:
  // - chatgpt / gemini / aistudio / claude : ì „ìš© ê·œì¹™
  // - generic_stop : "Stop/ì¤‘ì§€/Cancel/ì·¨ì†Œ" ë²„íŠ¼ ê°€ì‹œì„± ê¸°ë°˜ ë²”ìš© ê·œì¹™
  const DETECTION_MODES = [
    { key: 'chatgpt', label: 'ChatGPT ì „ìš©' },
    { key: 'gemini', label: 'Gemini ì „ìš©' },
    { key: 'aistudio', label: 'AI Studio ì „ìš©' },
    { key: 'claude', label: 'Claude ì „ìš©' },
    { key: 'generic_stop', label: 'ë²”ìš©(Stop/ì¤‘ì§€ ë²„íŠ¼)' },
  ];

  // "ë“±ë¡ ê°€ëŠ¥í•œ" ê¸°ë³¸ ì‚¬ì´íŠ¸ë“¤
  // - ì‚¬ìš©ìê°€ íŒì—…ì—ì„œ on/off
  // - ì¶”ê°€ë¡œ "ì§ì ‘ ì¶”ê°€"(customSites) ê°€ëŠ¥
  const BUILTIN_SITES = [
    {
      key: 'chatgpt',
      name: 'ChatGPT',
      patterns: ['https://chatgpt.com/*'],
      detection: 'chatgpt',
      defaultEnabled: true,
    },
    {
      key: 'gemini',
      name: 'Gemini',
      patterns: ['https://gemini.google.com/*'],
      detection: 'gemini',
      defaultEnabled: true,
    },
    {
      key: 'aistudio',
      name: 'AI Studio',
      patterns: ['https://aistudio.google.com/*'],
      detection: 'aistudio',
      defaultEnabled: false,
    },
    {
      key: 'claude',
      name: 'Claude',
      patterns: ['https://claude.ai/*'],
      detection: 'claude',
      defaultEnabled: false,
    },
    // ìì£¼ ì“°ëŠ” ê³³ë“¤(ë²”ìš© Stop ê·œì¹™)
    {
      key: 'perplexity',
      name: 'Perplexity',
      patterns: ['https://www.perplexity.ai/*', 'https://perplexity.ai/*'],
      detection: 'generic_stop',
      defaultEnabled: false,
    },
    {
      key: 'poe',
      name: 'Poe',
      patterns: ['https://poe.com/*'],
      detection: 'generic_stop',
      defaultEnabled: false,
    },
    {
      key: 'copilot',
      name: 'Copilot',
      patterns: ['https://copilot.microsoft.com/*'],
      detection: 'generic_stop',
      defaultEnabled: false,
    },
  ];

  // =============== Match Pattern Utils (Chrome match patterns) ===============
  const _patternRegexCache = new Map();

  function escapeRegex(s) {
    return s.replace(/[.*+?^${}()|[\]\\]/g, '\\$&');
  }

  // Chrome match pattern -> RegExp
  // - <all_urls>
  // - scheme://host/path
  //   scheme: * | http | https
  //   host: * | *.domain.com | domain.com
  //   path: /* ì™€ì¼ë“œì¹´ë“œ
  function matchPatternToRegex(pattern) {
    if (_patternRegexCache.has(pattern)) return _patternRegexCache.get(pattern);

    let re;
    if (pattern === '<all_urls>') {
      // content scriptëŠ” http/httpsì—ì„œë§Œ ì‹¤ì œë¡œ ì˜ë¯¸ê°€ ìˆìœ¼ë‹ˆ ìµœì†Œ ë²”ìœ„ë¡œ ì œí•œ
      re = /^https?:\/\//i;
      _patternRegexCache.set(pattern, re);
      return re;
    }

    const parts = pattern.split('://');
    if (parts.length !== 2) {
      // ì‹¤íŒ¨ ì¼€ì´ìŠ¤ëŠ” í•­ìƒ false ë§¤ì¹­
      re = /^$/;
      _patternRegexCache.set(pattern, re);
      return re;
    }
    const scheme = parts[0];
    const rest = parts[1];

    const slashIdx = rest.indexOf('/');
    const hostPart = slashIdx >= 0 ? rest.slice(0, slashIdx) : rest;
    const pathPart = slashIdx >= 0 ? rest.slice(slashIdx) : '/*';

    const schemeRe = scheme === '*' ? 'https?' : escapeRegex(scheme);

    let hostRe;
    if (hostPart === '*') hostRe = '[^/]+?';
    else if (hostPart.startsWith('*.')) {
      const domain = hostPart.slice(2);
      hostRe = `(?:[^/]+?\\.)?${escapeRegex(domain)}`;
    } else hostRe = escapeRegex(hostPart);

    // path: '*' -> '.*'
    const pathEsc = escapeRegex(pathPart).replace(/\\\*/g, '.*');
    re = new RegExp(`^${schemeRe}://${hostRe}${pathEsc}$`, 'i');
    _patternRegexCache.set(pattern, re);
    return re;
  }

  function urlMatchesPattern(url, pattern) {
    try {
      const re = matchPatternToRegex(pattern);
      return re.test(url);
    } catch (_) {
      return false;
    }
  }

  function urlMatchesAny(url, patterns) {
    if (!patterns || !patterns.length) return false;
    return patterns.some((p) => urlMatchesPattern(url, p));
  }

  function normalizePatterns(rawText) {
    if (!rawText) return [];
    if (Array.isArray(rawText)) {
      return rawText
        .map((s) => String(s || '').trim())
        .filter(Boolean);
    }
    return String(rawText)
      .split(/\r?\n|,|;/g)
      .map((s) => s.trim())
      .filter(Boolean);
  }

  function isProbablyValidMatchPattern(pattern) {
    if (!pattern) return false;
    if (pattern === '<all_urls>') return true;
    // ë„ˆë¬´ ë¹¡ì„¸ê²Œ ê²€ì¦í•˜ë©´ ì‚¬ìš©ìê°€ ë‹µë‹µí•´í•˜ë‹ˆ, ìµœì†Œí•œë§Œ ì²´í¬
    // - scheme://host/...
    // - pathì— *ê°€ ì„ì¼ ìˆ˜ ìˆìŒ
    const m = pattern.match(/^([*a-zA-Z]+):\/\/([^/]+)(\/.*)?$/);
    if (!m) return false;
    const scheme = m[1];
    if (!(scheme === '*' || scheme === 'http' || scheme === 'https')) return false;
    const host = m[2];
    if (!host || host.includes(' ')) return false;
    // hostì— '*' í—ˆìš©(*, *.domain)
    if (host !== '*' && host.includes('*') && !host.startsWith('*.')) return false;
    return true;
  }

  function defaultEnabledSites() {
    const enabled = {};
    for (const s of BUILTIN_SITES) enabled[s.key] = !!s.defaultEnabled;
    return enabled;
  }

  function ensureEnabledSitesObject(enabledSites) {
    const defaults = defaultEnabledSites();
    if (!enabledSites || typeof enabledSites !== 'object') return defaults;
    // ëˆ„ë½ëœ keyë§Œ ê¸°ë³¸ê°’ìœ¼ë¡œ ì±„ì›€(ê¸°ì¡´ ì„¤ì • ìœ ì§€)
    for (const k of Object.keys(defaults)) {
      if (!(k in enabledSites)) enabledSites[k] = defaults[k];
    }
    return enabledSites;
  }

  // custom site shape:
  // {
  //   id: "custom_xxx",
  //   name: "ë‚´ ì‚¬ì´íŠ¸",
  //   patterns: ["https://example.com/*"],
  //   detection: "generic_stop",
  //   enabled: true
  // }
  function normalizeCustomSites(customSites) {
    if (!Array.isArray(customSites)) return [];
    return customSites
      .map((s) => {
        const id = String(s?.id || '').trim();
        const name = String(s?.name || '').trim() || 'Custom';
        const patterns = normalizePatterns(s?.patterns);
        const detection = String(s?.detection || 'generic_stop').trim();
        const enabled = !!s?.enabled;
        if (!id || !patterns.length) return null;
        return { id, name, patterns, detection, enabled };
      })
      .filter(Boolean);
  }

  function resolveSiteFromConfig(url, enabledSites, customSites) {
    const enabled = ensureEnabledSitesObject(enabledSites);
    const customs = normalizeCustomSites(customSites);

    // 1) custom ìš°ì„ (ì‚¬ìš©ì ëª…ì‹œ)
    for (const c of customs) {
      if (!c.enabled) continue;
      if (urlMatchesAny(url, c.patterns)) {
        return {
          key: c.id,
          name: c.name,
          patterns: c.patterns,
          detection: c.detection || 'generic_stop',
          isCustom: true,
        };
      }
    }

    // 2) builtin
    for (const s of BUILTIN_SITES) {
      if (!enabled[s.key]) continue;
      if (urlMatchesAny(url, s.patterns)) {
        return {
          key: s.key,
          name: s.name,
          patterns: s.patterns,
          detection: s.detection,
          isCustom: false,
        };
      }
    }

    return null;
  }

  // ê°„ë‹¨ UUID(ì¶©ëŒë§Œ í”¼í•˜ë©´ ë¨)
  function makeCustomId() {
    const rand = Math.random().toString(16).slice(2);
    return `custom_${Date.now().toString(16)}_${rand}`;
  }

  // Export to global
  window.ReadyAi = window.ReadyAi || {};
  window.ReadyAi.sites = {
    STORAGE_KEYS,
    DETECTION_MODES,
    BUILTIN_SITES,
    matchPatternToRegex,
    urlMatchesAny,
    normalizePatterns,
    isProbablyValidMatchPattern,
    defaultEnabledSites,
    ensureEnabledSitesObject,
    normalizeCustomSites,
    resolveSiteFromConfig,
    makeCustomId,
  };
})();

```
